## Application 5

:::{.callout-tip collapse="true" icon=false}
## Introduction à la publication reproductible

:::{.incremental}
1. Cliquer sur `File > New file > Quarto document`:
    + Donner un titre et un(e) auteur(e) au rapport
    + Choisir `HTML` comme format de sortie
    + Décocher la case `Use visual markdown editor`
2. Sauvegarder le fichier sous le nom `report.qmd`.
:::

:::

## Application 5 {.smaller}

:::{.callout-tip collapse="true" icon=false}
## Introduction à la publication reproductible (suite)

:::{.incremental}
4. Produire une courte note présentant le tableau des âges produit précédemment :
    + Dans le fichier `.qmd`, reprendre le pipeline du `script.R`. 
        + Importer les packages et les fonctions locales.
        + Importer le fichier `individu_reg.parquet` dans un data.frame nommé `df`.
        + Faire les retraitements et la production de `table_age`.
            + Le contenu produit par ces _chunk_ doit être caché (le code et les messages produits à l'execution), il est donc nécessaire d'utiliser une [option](https://quarto.org/docs/computations/execution-options.html)
    + Afficher ce tableau `table_age` dans le document.
    + Ajouter une courte phrase d'introduction
    
5. Générer le rapport avec le bouton `Render` et vérifier que l'*output* correspond à celui attendu.
:::

:::

::: {.callout-important}
En supposant que ce document soit à vocation d'une audience non technique, masquer le code ayant généré les sorties
:::

## Application 5 {.smaller}

:::{.callout-tip collapse="true" icon=false}
## Introduction à la publication reproductible (suite)

6. Dans `script.R`, nous avions créé un graphique `p.png`. 
    + A partir des exemples de la [documentation](https://quarto.org/docs/authoring/figures.html)
introduire cette figure
    + La faire précéder d'une phrase d'introduction.
    + Êtes-vous sûr que cette figure est à jour ? (*sploiler : non*)

7. A partir de la fonction suivante à mettre dans `R/functions.R`, 
afficher le graphique de la part des hommes *via* un nouveau chunk de votre `.qmd`.

```r
figure_part_homme_age <- function(df){
  p <- df %>%
    group_by(aged, sexe) %>%
    summarise(SH_sexe = n()) %>%
    group_by(aged) %>%
    mutate(SH_sexe = SH_sexe / sum(SH_sexe)) %>%
    filter(sexe == "Homme") %>%
    ggplot() +
    geom_bar(aes(x = aged, y = SH_sexe), stat = "identity") +
    geom_point(
      aes(x = aged, y = SH_sexe),
      stat = "identity", color = "red") +
    coord_cartesian(c(0, 100))
  return(p)
}
```

8. Cliquer sur le bouton `Render` pour mettre à jour votre note
:::


## Checkpoint

::: {layout=[30,70]}

- [report.qmd](https://raw.githubusercontent.com/InseeFrLab/formation-bonnes-pratiques-R/main/R/checkpoints/application5/report.qmd)
- [functions.R](https://raw.githubusercontent.com/InseeFrLab/formation-bonnes-pratiques-R/main/R/checkpoints/application5/functions.R)

![](checkpoint.jpg){width=60%}
:::