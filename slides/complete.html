<!DOCTYPE html>
<html lang="fr-FR"><head>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/tabby.min.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.7.31">

  <meta name="author" content="Romain Avouac, Lino Galiana">
  <title>Formation aux bonnes pratiques `Git` et `R` – Bonnes pratiques pour les projets statistiques</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../site_libs/revealjs/dist/theme/quarto-7230c0af59ab1606bc2ed49e76979e8e.css">
  <link rel="stylesheet" href="_extensions/InseeFrLab/onyxia/logo.css">
  <link rel="stylesheet" href="custom.css">
  <link href="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<meta name="twitter:title" content="Bonnes pratiques pour les projets statistiques – Formation aux bonnes pratiques Git et R">
<meta name="twitter:description" content="Une formation aux bonnes pratiques avec Git et R">
<meta name="twitter:image" content="https://InseeFrLab.github.io/formation-bonnes-pratiques-git-R//cards/version-light/cheetah.png">
<meta name="twitter:image-height" content="1024">
<meta name="twitter:image-width" content="1024">
<meta name="twitter:card" content="summary_large_image">
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" data-background-image="_extensions/InseeFrLab/onyxia/background.svg" data-background-size="contain" class="quarto-title-block center">
  <h1 class="title">Bonnes pratiques pour les projets statistiques</h1>
  <p class="subtitle"></p><p><strong><span class="orange">Une formation aux bonnes pratiques avec Git et R</span></strong></p><p></p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
 
</div>
</div>
</div>

</section>
<section id="introduction" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Introduction</h2>
<ul>
<li>Version longue de la formation aux bonnes pratiques avec <code>R</code> et <code>Git</code> (<a href="https://inseefrlab.github.io/formation-bonnes-pratiques-git-R/">page d’accueil</a>)</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="https://inseefrlab.github.io/formation-bonnes-pratiques-git-R/cards/version-full/eagle.png" class="quarto-figure quarto-figure-center" height="400"></p>
</figure>
</div>
</section>
<section>
<section id="introduction-1" class="title-slide slide level1 center" data-background-image="background.svg" data-background-size="contain">
<h1>Introduction</h1>

</section>
<section id="la-notion-de-bonnes-pratiques" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>La notion de bonnes pratiques</h2>
<ul>
<li class="fragment"><p><span class="blue2"><strong>Origine</strong></span> : communauté des développeurs logiciels</p></li>
<li class="fragment"><p><span class="blue2"><strong>Constats</strong></span> :</p>
<ul>
<li class="fragment">le <span class="green2"><em>“code est plus souvent lu qu’écrit”</em></span> (<a href="https://fr.wikipedia.org/wiki/Guido_van_Rossum">Guido Van Rossum</a>)</li>
<li class="fragment">la maintenance d’un code est très coûteuse</li>
</ul></li>
<li class="fragment"><p><span class="blue2"><strong>Conséquence</strong></span> : un ensemble de <span class="orange"><strong>règles informelles</strong></span>, conventionnellement acceptées comme produisant des logiciels <span class="orange"><strong>fiables</strong></span>, <span class="orange"><strong>évolutifs</strong></span> et <span class="orange"><strong>maintenables</strong></span></p></li>
</ul>
</section>
<section id="pourquoi-sintéresser-aux-bonnes-pratiques" class="slide level2 smaller" data-background-image="background.svg" data-background-size="contain">
<h2>Pourquoi s’intéresser aux bonnes pratiques ?</h2>
<p><br></p>
<p>L’activité du statisticien / <em>datascientist</em> tend à se rapprocher de celle du développeur :</p>
<ul>
<li class="fragment"><p>projets <span class="orange"><strong>intenses en code</strong></span></p></li>
<li class="fragment"><p><span class="orange"><strong>projets collaboratifs</strong></span> et de grande envergure</p></li>
<li class="fragment"><p><span class="orange"><strong>complexification</strong></span> des données et donc des <span class="orange"><strong>infrastructures</strong></span></p></li>
<li class="fragment"><p><span class="orange"><strong>déploiement</strong></span> d’applications pour valoriser les analyses</p></li>
</ul>
</section>
<section id="bonnes-pratiques-et-reproductibilité" class="slide level2 smaller" data-background-image="background.svg" data-background-size="contain">
<h2>Bonnes pratiques et reproductibilité</h2>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="img/reprospectrum.png" class="quarto-figure quarto-figure-center" height="200"></p>
</figure>
</div>
<p><strong>Source</strong> : Peng R., Reproducible Research in Computational Science, Science (2011)</p>
<ul>
<li class="fragment"><p>Une reproductibilité parfaite est <span class="orange"><strong>coûteuse</strong></span></p></li>
<li class="fragment"><p><code>Git</code> est un <span class="orange"><strong>standard atteignable</strong></span> et <span class="orange"><strong>efficient</strong></span></p></li>
</ul>
<div class="fragment">
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Note</strong></p>
</div>
<div class="callout-content">
<p><strong>Quel socle de bonnes pratiques pour les projets statistiques en <i class="fa-brands fa-r-project" aria-label="r-project"></i> ?</strong></p>
</div>
</div>
</div>
</div>
</section>
<section id="horizon-de-cette-formation" class="slide level2" data-auto-animate="true" data-background-image="background.svg" data-background-size="contain">
<h2 data-id="quarto-animate-title">Horizon de cette formation</h2>
<p>Un point de départ commun</p>

<img data-src="img/environment_messy.png" class="r-stretch"></section>
<section id="horizon-de-cette-formation-1" class="slide level2" data-auto-animate="true" data-background-image="background.svg" data-background-size="contain">
<h2 data-id="quarto-animate-title">Horizon de cette formation</h2>
<p>Un point de départ commun <img data-src="img/environment_messy.png" class="quarto-figure quarto-figure-right" style="width:10.0%"></p>
<p>Une structuration de projet plus viable</p>
<p><img data-src="img/environment_clean.png"></p>
</section></section>
<section>
<section id="partie-1-contrôle-de-version-avec-git" class="title-slide slide level1 center" data-background-image="background.svg" data-background-size="contain">
<h1>Partie 1 : contrôle de version avec <code>Git</code></h1>

</section>
<section id="plan-de-la-partie" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Plan de la partie</h2>
<p><span class="emoji" data-emoji="one">1️⃣</span> Le <span class="orange"><strong>contrôle de version</strong></span> : pourquoi faire ?</p>
<p><span class="emoji" data-emoji="two">2️⃣</span> Le <span class="orange"><strong>contrôle de version</strong></span> avec <code>Git</code></p>
<p><span class="emoji" data-emoji="three">3️⃣</span> Le <span class="orange"><strong>travail collaboratif</strong></span> avec <code>Git</code></p>
</section></section>
<section>
<section id="i--le-contrôle-de-version-pourquoi-faire" class="title-slide slide level1 center" data-background-image="background.svg" data-background-size="contain">
<h1>I- Le contrôle de version : pourquoi faire ?</h1>

</section>
<section id="archiver-son-code-proprement" class="slide level2" data-auto-animate="true" data-background-image="background.svg" data-background-size="contain">
<h2 data-id="quarto-animate-title"><span class="emoji" data-emoji="one">1️⃣</span> Archiver son code proprement</h2>
<p>pour en finir avec ça :</p>

<img data-src="img/fichiers_multiples.png" class="r-stretch"></section>
<section id="archiver-son-code-proprement-1" class="slide level2" data-auto-animate="true" data-background-image="background.svg" data-background-size="contain">
<h2 data-id="quarto-animate-title"><span class="emoji" data-emoji="one">1️⃣</span> Archiver son code proprement</h2>
<p>ou ça :</p>

<img data-src="img/finalfinal.png" class="quarto-figure quarto-figure-center r-stretch"></section>
<section id="archiver-son-code-proprement-2" class="slide level2" data-auto-animate="true" data-background-image="background.svg" data-background-size="contain">
<h2 data-id="quarto-animate-title"><span class="emoji" data-emoji="one">1️⃣</span> Archiver son code proprement</h2>
<p>ou encore ça :</p>
<div class="sourceCode" id="cb1" data-code-line-numbers="12-18"><pre class="sourceCode numberSource python number-lines code-with-copy" data-id="quarto-animate-code"><code class="sourceCode python hljs"><span id="cb1-1" class="hljs-ln-code"><a></a>prior <span class="op">&lt;-</span> read_csv(prior_path)</span>
<span id="cb1-2" class="hljs-ln-code"><a></a>prior <span class="op">&lt;-</span> prior <span class="op">|&gt;</span></span>
<span id="cb1-3" class="hljs-ln-code"><a></a>    select(<span class="bu">id</span>, proba_inter, proba_build, proba_rfl) <span class="op">|&gt;</span></span>
<span id="cb1-4" class="hljs-ln-code"><a></a>    separate(<span class="bu">id</span>, into <span class="op">=</span> c(<span class="st">'nidt'</span>, <span class="st">'grid_id'</span>), sep <span class="op">=</span> <span class="st">":"</span>) <span class="op">|&gt;</span></span>
<span id="cb1-5" class="hljs-ln-code"><a></a>    group_by(nidt) <span class="op">|&gt;</span></span>
<span id="cb1-6" class="hljs-ln-code"><a></a>    mutate(</span>
<span id="cb1-7" class="hljs-ln-code"><a></a>        proba_build <span class="op">=</span> proba_build<span class="op">/</span><span class="bu">sum</span>(proba_build),</span>
<span id="cb1-8" class="hljs-ln-code"><a></a>        proba_rfl <span class="op">=</span> proba_rfl<span class="op">/</span><span class="bu">sum</span>(proba_rfl),</span>
<span id="cb1-9" class="hljs-ln-code"><a></a>        ) <span class="op">|&gt;</span></span>
<span id="cb1-10" class="hljs-ln-code"><a></a>    unite(col <span class="op">=</span> <span class="st">"id"</span>, nidt, grid_id, sep <span class="op">=</span> <span class="st">":"</span>)</span>
<span id="cb1-11" class="hljs-ln-code"><a></a></span>
<span id="cb1-12" class="hljs-ln-code"><a></a><span class="co"># Test</span></span>
<span id="cb1-13" class="hljs-ln-code"><a></a><span class="co"># prior_test &lt;- prior |&gt;</span></span>
<span id="cb1-14" class="hljs-ln-code"><a></a><span class="co">#    mutate(</span></span>
<span id="cb1-15" class="hljs-ln-code"><a></a><span class="co">#        proba_inter = round(proba_inter, 4)</span></span>
<span id="cb1-16" class="hljs-ln-code"><a></a><span class="co">#        proba_build = round(proba_build, 4)</span></span>
<span id="cb1-17" class="hljs-ln-code"><a></a><span class="co">#        proba_rfl = round(proba_rfl, 4)</span></span>
<span id="cb1-18" class="hljs-ln-code"><a></a><span class="co">#    )</span></span>
<span id="cb1-19" class="hljs-ln-code"><a></a></span>
<span id="cb1-20" class="hljs-ln-code"><a></a>write_csv(prior_round, <span class="st">"~/prior.csv"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="archiver-son-code-proprement-3" class="slide level2" data-auto-animate="true" data-background-image="background.svg" data-background-size="contain">
<h2 data-id="quarto-animate-title"><span class="emoji" data-emoji="one">1️⃣</span> Archiver son code proprement</h2>
<p>Pour arriver à ça :</p>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="img/timeline.png" class="quarto-figure quarto-figure-center" height="475"></p>
</figure>
</div>
<p>Source : <a href="https://thinkr.fr/travailler-avec-git-via-rstudio-et-versionner-son-code/">ThinkR</a></p>
</section>
<section id="voyager-dans-le-temps-de-votre-projet" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2><span class="emoji" data-emoji="two">2️⃣</span> Voyager dans le temps (de votre projet)</h2>

<img data-src="img/historique_utilitr.png" class="quarto-figure quarto-figure-center r-stretch"></section>
<section id="une-collaboration-simplifiée-et-efficace" class="slide level2" data-auto-animate="true" data-background-image="background.svg" data-background-size="contain">
<h2 data-id="quarto-animate-title"><span class="emoji" data-emoji="three">3️⃣</span> Une collaboration simplifiée et efficace</h2>
<p>Un modèle distribué</p>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="img/git_distributed.png" class="quarto-figure quarto-figure-center" height="475"></p>
</figure>
</div>
<p>Source : <a href="https://www.specbee.com">specbee.com</a></p>
</section>
<section id="une-collaboration-simplifiée-et-efficace-1" class="slide level2" data-auto-animate="true" data-background-image="background.svg" data-background-size="contain">
<h2 data-id="quarto-animate-title"><span class="emoji" data-emoji="three">3️⃣</span> Une collaboration simplifiée et efficace</h2>
<p>Qui permet l’expérimentation en toute sécurité</p>

<img data-src="img/branches.png" class="quarto-figure quarto-figure-center r-stretch"><p>Source : <a href="https://lutece.paris.fr/support/jsp/site/Portal.jsp?page=wiki&amp;view=page&amp;page_name=git&amp;language=fr">lutece.paris.fr</a></p>
</section>
<section id="une-collaboration-simplifiée-et-efficace-2" class="slide level2" data-auto-animate="true" data-background-image="background.svg" data-background-size="contain">
<h2 data-id="quarto-animate-title"><span class="emoji" data-emoji="three">3️⃣</span> Une collaboration simplifiée et efficace</h2>
<p>Quel que soit l’environnement de travail</p>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="img/envtravail.png" class="quarto-figure quarto-figure-center" height="475"></p>
</figure>
</div>
</section>
<section id="une-collaboration-simplifiée-et-efficace-3" class="slide level2" data-auto-animate="true" data-background-image="background.svg" data-background-size="contain">
<h2 data-id="quarto-animate-title"><span class="emoji" data-emoji="three">3️⃣</span> Une collaboration simplifiée et efficace</h2>
<p>Avec des outils pour faciliter la collaboration</p>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="img/issue.png" class="quarto-figure quarto-figure-center" height="500"></p>
</figure>
</div>
</section>
<section id="partager-son-code-à-un-public-large" class="slide level2" data-auto-animate="true" data-background-image="background.svg" data-background-size="contain">
<h2 data-id="quarto-animate-title"><span class="emoji" data-emoji="four">4️⃣</span> Partager son code à un public large</h2>
<p>Une vitrine pour les projets et l’organisation</p>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="img/ghinseefr.png" class="quarto-figure quarto-figure-center" height="475"></p>
</figure>
</div>
</section>
<section id="en-résumé" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>En résumé</h2>
<ul>
<li class="fragment"><p><span class="blue2"><strong>Construire</strong></span> et <span class="blue2"><strong>naviguer</strong></span> à travers l’<span class="orange"><strong>historique</strong></span> de son projet</p></li>
<li class="fragment"><p>La <span class="orange"><strong>collaboration</strong></span> rendue <span class="blue2"><strong>simple</strong></span> et <span class="blue2"><strong>efficace</strong></span></p></li>
<li class="fragment"><p>Améliorer la <span class="orange"><strong>reproductibilité</strong></span> de ses projets</p></li>
<li class="fragment"><p>Améliorer la <span class="orange"><strong>visibilité</strong></span> de ses projets</p></li>
</ul>
</section></section>
<section>
<section id="ii--le-contrôle-de-version-avec-git" class="title-slide slide level1 center" data-background-image="background.svg" data-background-size="contain">
<h1>II- Le contrôle de version avec <code>Git</code></h1>

</section>
<section id="git-est-complexe" class="slide level2" data-auto-animate="true" data-background-image="background.svg" data-background-size="contain">
<h2 data-id="quarto-animate-title"><span class="emoji" data-emoji="warning">⚠️</span> Git est complexe</h2>
<p>L’utilisation de <code>Git</code> nécessite <span class="orange"><strong>certaines notions préalables</strong></span>:</p>
<ul>
<li class="fragment">Fonctionnement d’un <code>filesystem</code></li>
<li class="fragment">Connaissance basique du terminal <code>Linux</code></li>
<li class="fragment">Potentiellement, un grand nombre de commandes</li>
</ul>
<div class="fragment">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="img/gitfire.png" height="300"></p>
<figcaption>Source : <a href="https://iulianacosmina.com/?p=19452">iulianacosmina.com</a></figcaption>
</figure>
</div>
</div>
</section>
<section id="git-est-complexe-1" class="slide level2" data-auto-animate="true" data-background-image="background.svg" data-background-size="contain">
<h2 data-id="quarto-animate-title"><span class="emoji" data-emoji="warning">⚠️</span> Git est complexe</h2>
<p><span class="blue2"><strong>Mais</strong></span></p>
<ul>
<li class="fragment">L’<strong>usage quotidien</strong> n’implique que <span class="orange"><strong>quelques commandes</strong></span></li>
<li class="fragment">Les <span class="orange"><strong>messages</strong></span> de <code>Git</code> sont très informatifs</li>
<li class="fragment">Enormément de <span class="orange"><strong>ressources</strong></span> disponibles sur internet</li>
<li class="fragment">Des <span class="orange"><strong>interfaces visuelles</strong></span> (ex: <code>RStudio</code>, <code>Sublime Merge</code>, <code>VS Code</code>) qui facilitent l’apprentissage</li>
<li class="fragment">Un petit investissement individuel pour de <span class="orange"><strong>gros gains collectifs</strong></span></li>
</ul>
</section>
<section id="concepts" class="slide level2" data-auto-animate="true" data-background-image="background.svg" data-background-size="contain">
<h2 data-id="quarto-animate-title">Concepts</h2>
<h4 data-background-image="background.svg" data-background-size="contain" id="git-github-gitlab-quelles-différences"><code>Git</code>, <code>GitHub</code>, <code>GitLab</code>… quelles différences ?</h4>
<ul>
<li class="fragment"><code>Git</code> est un <strong>logiciel</strong> ;</li>
<li class="fragment">Utilisation en ligne de commandes</li>
<li class="fragment">Différentes <span class="blue2"><strong>interfaces graphiques</strong></span> (<code>RStudio</code>, <code>VS Code</code>…)</li>
</ul>
</section>
<section id="concepts-1" class="slide level2" data-auto-animate="true" data-background-image="background.svg" data-background-size="contain">
<h2 data-id="quarto-animate-title">Concepts</h2>
<h4 data-background-image="background.svg" data-background-size="contain" id="git-github-gitlab-quelles-différences-1"><code>Git</code>, <code>GitHub</code>, <code>GitLab</code>… quelles différences ?</h4>
<ul>
<li class="fragment"><code>GitHub</code> et <code>GitLab</code> sont des <strong>forges logicielles</strong></li>
<li class="fragment"><em>Forge</em>: espace d’archivage de code</li>
<li class="fragment">Des fonctionalités supplémentaires : <strong>réseau social du code</strong></li>
</ul>
<div class="callout callout-tip callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Astuce</strong></p>
</div>
<div class="callout-content">
<ul>
<li class="fragment"><code>GitHub</code> : utilisation pour les projets <strong>open-source</strong></li>
<li class="fragment"><code>GitLab</code> : utilisation pour les projets <strong>internes</strong></li>
</ul>
</div>
</div>
</div>
</section>
<section id="concepts-2" class="slide level2" data-auto-animate="true" data-background-image="background.svg" data-background-size="contain">
<h2 data-id="quarto-animate-title">Concepts</h2>
<h4 data-background-image="background.svg" data-background-size="contain" id="dépôt-local-dépôt-distant-remote">Dépôt local / dépôt distant (<code>remote</code>)</h4>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="img/localremote.png" class="quarto-figure quarto-figure-center" height="400"></p>
</figure>
</div>
<ul>
<li class="fragment">Par défaut, le dépôt distant porte l’alias <code>origin</code></li>
</ul>
<!-- ## Concepts {auto-animate=true}

_Workflow_ (version littéraire) :

- On travaille sur un dépôt local en éditant des fichiers
- On dit à `Git` que ces fichiers doivent être suivis (`staging area`)
- On valide les modifications faites en local (`commit`)
- On soumet les modifications (`push`) après avoir récupéré la version collective (`pull`) -->
</section>
<section id="concepts-3" class="slide level2" data-auto-animate="true" data-background-image="background.svg" data-background-size="contain">
<h2 data-id="quarto-animate-title">Concepts</h2>
<h4 data-background-image="background.svg" data-background-size="contain" id="workflow-local"><em>Workflow</em> local</h4>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="img/areas.png" class="quarto-figure quarto-figure-center" height="400"></p>
</figure>
</div>
<p>Source : <a href="https://git-scm.com/book/en/v2/Getting-Started-What-is-Git%3F">Git Documentation</a></p>
</section>
<section id="concepts-4" class="slide level2" data-auto-animate="true" data-background-image="background.svg" data-background-size="contain">
<h2 data-id="quarto-animate-title">Concepts</h2>
<h4 data-background-image="background.svg" data-background-size="contain" id="workflow-complet"><em>Workflow</em> complet</h4>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="img/completeworkflow.png" width="500" height="400"></p>
<figcaption>Source : <a href="https://itnext.io/git-concepts-for-newcomers-part-2-git-repository-working-tree-and-staging-area-a2e720bf3528">itnext.io</a></figcaption>
</figure>
</div>
</section>
<section id="commandes-essentielles" class="slide level2" data-auto-animate="true" data-background-image="background.svg" data-background-size="contain">
<h2 data-id="quarto-animate-title">Commandes essentielles</h2>
<p><br></p>
<table class="caption-top">
<thead>
<tr class="header">
<th>Action</th>
<th>Commande</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Cloner un projet</td>
<td><code>git clone [url-to-git-repo]</code></td>
</tr>
<tr class="even">
<td>Afficher les changements</td>
<td><code>git status</code></td>
</tr>
<tr class="odd">
<td>Retrouver l’URL du dépôt distant</td>
<td><code>git remote -v</code></td>
</tr>
</tbody>
</table>
</section>
<section id="commandes-essentielles-1" class="slide level2 smaller" data-auto-animate="true" data-background-image="background.svg" data-background-size="contain">
<h2 data-id="quarto-animate-title">Commandes essentielles</h2>
<p><br></p>
<table class="caption-top">
<colgroup>
<col style="width: 44%">
<col style="width: 55%">
</colgroup>
<thead>
<tr class="header">
<th>Action</th>
<th>Commande</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Ajouter des changements à l’index de <code>Git</code> (<em>stage fixes</em>)</td>
<td>Un seul fichier : <code>git add &lt;file-name&gt;</code> <br> Tous les fichiers déjà indexés : <code>git add -u</code> <br> Tous les fichiers <span class="emoji" data-emoji="warning">⚠️</span> : <code>git add -A</code></td>
</tr>
</tbody>
</table>
<p><br></p>
<div class="callout callout-important callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Warning</strong></p>
</div>
<div class="callout-content">
<p>La méthode <code>git add -A</code> peut amener à suivre les modifications de fichiers qui ne devraient pas l’être (par exemple, des données).</p>
<p>Il est recommandé de bien réfléchir avant de l’utiliser (ou d’avoir un bon <code>.gitignore</code>)</p>
</div>
</div>
</div>
</section>
<section id="commandes-essentielles-2" class="slide level2" data-auto-animate="true" data-background-image="background.svg" data-background-size="contain">
<h2 data-id="quarto-animate-title">Commandes essentielles</h2>
<p><br></p>
<table class="caption-top">
<colgroup>
<col style="width: 44%">
<col style="width: 55%">
</colgroup>
<thead>
<tr class="header">
<th>Action</th>
<th>Commande</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Faire un <code>commit</code></td>
<td><code>git commit -m "message"</code></td>
</tr>
<tr class="even">
<td>Pousser les changements locaux vers le dépôt distant (branche <code>master</code>)</td>
<td><code>git push origin master</code></td>
</tr>
<tr class="odd">
<td>Récupérer les changements sur le dépôt distant (branche <code>master</code>)</td>
<td><code>git pull origin master</code></td>
</tr>
</tbody>
</table>
</section>
<section id="modes-dauthentification" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Modes d’authentification</h2>
<div class="panel-tabset">
<ul id="tabset-1" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-1-1"><i class="fa-brands fa-github" aria-label="github"></i></a></li><li><a href="#tabset-1-2"><i class="fa-brands fa-gitlab" aria-label="gitlab"></i> insee</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1">
<div style="font-size: 75%;">
<ul>
<li><span class="orange"><strong>https</strong></span>
<ul>
<li><code>git clone https://github.com/username/projet.git</code></li>
<li>simple à utiliser</li>
<li>authentification username + password (ou token) à chaque <em>push</em></li>
</ul></li>
<li><span class="orange"><strong>ssh</strong></span>
<ul>
<li><code>git clone git@github.com:username/projet.git</code></li>
<li>(plus) complexe à initialiser</li>
<li>authentification automatique</li>
</ul></li>
</ul>
</div>
</div>
<div id="tabset-1-2">
<div style="font-size: 75%;">
<ul>
<li><span class="orange"><strong>https</strong></span>
<ul>
<li><code>git clone https://gitlab.insee.fr/username_or_groupname/projet.git</code></li>
<li>simple à utiliser</li>
<li>authentification username + password (ou token) à chaque <em>push</em></li>
</ul></li>
<li><span class="orange"><strong>ssh</strong></span>
<ul>
<li><code>git clone git@gitlab.insee.fr:username_or_groupname/projet.git</code></li>
<li>(plus) complexe à initialiser</li>
<li>authentification automatique</li>
</ul></li>
</ul>
</div>
</div>
</div>
</div>
</section>
<section id="application-0" class="slide level2 smaller" data-background-image="background.svg" data-background-size="contain">
<h2>Application 0</h2>
<div class="panel-tabset">
<ul id="tabset-2" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-2-1"><i class="fa-brands fa-github" aria-label="github"></i></a></li><li><a href="#tabset-2-2"><i class="fa-brands fa-gitlab" aria-label="gitlab"></i> insee</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1">
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Préparation de l’environnement de travail</strong></p>
</div>
<div class="callout-content">
<ol type="1">
<li>Créer un compte <a href="https://github.com/"><code>GitHub</code></a></li>
<li>Créer un nouveau dépôt <strong>privé</strong> sur <code>GitHub</code> en <strong>incluant un fichier <code>README</code></strong></li>
<li>Créer un compte sur le <a href="https://datalab.sspcloud.fr/home">SSP Cloud</a></li>
<li>Lancer un service <code>RStudio</code>. Dans l’onglet de configuration <code>Git</code> du service, fixer la durée du <code>Cache</code> pour le stockage des identifiants <code>GitHub</code> à une valeur suffisamment élevée</li>
<li>Cloner le dépôt distant sur votre environnement local (ici, le <code>RStudio</code> du <code>Datalab</code>):
<ul>
<li><code>File</code> → <code>New project</code> → <code>Version Control</code> → <code>Git</code></li>
</ul></li>
<li><a href="https://docs.github.com/en/enterprise-server@3.4/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token">Générer un <em>token</em></a> (jeton d’authentification) sur <code>GitHub</code></li>
<li>Stocker le <em>token</em> sur le <code>SSP Cloud</code> (ou un gestionnaire de mot de passe) :
<ul>
<li><code>Mon Compte</code> -&gt; <code>Git</code> -&gt; <code>Token d'accès personnel pour Forge Git</code></li>
</ul></li>
<li>Terminer la procédure de clonage en fournissant le nom d’utilisateur <code>GitHub</code> et le <em>token</em></li>
</ol>
</div>
</div>
</div>
</div>
<div id="tabset-2-2">
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Préparation de l’environnement de travail</strong></p>
</div>
<div class="callout-content">
<ol type="1">
<li>Compte déjà créé sur le <a href="https://gitlab.insee.fr/">gitlab interne</a></li>
<li>Créer un nouveau dépôt <strong>privé</strong> sur <code>gitlab.insee.fr</code></li>
<li>Créer un compte sur <a href="https://datalab.sspcloud.fr/home">LS3</a> via AUS.</li>
<li>Lancer un service <code>RStudio</code>. Dans l’onglet de configuration <code>Git</code> du service, fixer la durée du <code>Cache</code> pour le stockage des identifiants <code>Gitlab</code> à une valeur suffisamment élevée</li>
<li>Cloner le dépôt distant sur votre environnement local (ici, le <code>RStudio</code> de la plateforme <code>LS3</code>):
<ul>
<li><code>File</code> → <code>New project</code> → <code>Version Control</code> → <code>Git</code></li>
</ul></li>
<li><a href="https://gitlab.insee.fr/-/user_settings/personal_access_tokens">Générer un <em>token</em></a> (jeton d’authentification) sur <code>gitlab.insee.fr</code></li>
<li>Stocker le <em>token</em> sur <code>LS3</code> (ou un gestionnaire de mot de passe) :
<ul>
<li><code>Mon Compte</code> -&gt; <code>Git</code> -&gt; <code>Token d'accès personnel pour Forge Git</code></li>
</ul></li>
<li>Terminer la procédure de clonage en fournissant le nom d’utilisateur (IDEP) et le <em>token</em></li>
</ol>
</div>
</div>
</div>
</div>
</div>
</div>
<p>❓ <strong>Question</strong> : qu’est ce qui différencie le projet cloné d’un projet quelconque ?</p>
</section>
<section id="application-1" class="slide level2 smaller" data-background-image="background.svg" data-background-size="contain">
<h2>Application 1</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Premiers commits</strong></p>
</div>
<div class="callout-content">
<ol type="1">
<li>Créer un dossier 📁 <code>scripts</code></li>
<li>Y créer les fichiers <code>script1.R</code> et <code>script2.R</code>, chacun contenant quelques commandes <code>R</code> de votre choix</li>
<li>Ajouter ces fichiers à la zone de <em>staging</em> de Git en les cochant dans l’interface <code>RStudio</code></li>
<li>Effectuer un <code>commit</code>, auquel on donnera un message descriptif pertinent</li>
<li>Supprimer le fichier <code>script1.R</code> et modifier le contenu du fichier <code>script2.R</code></li>
<li>Analyser ce qui se passe lorsque l’on coche ces fichiers dans l’interface <code>RStudio</code></li>
<li>Effectuer un nouveau <em>commit</em> pour ajouter ces modifications à l’historique</li>
<li>Visualiser l’historique du projet à partir de l’interface graphique de <code>RStudio</code></li>
</ol>
</div>
</div>
</div>
<p>❓ <strong>Question</strong> : à ce stade, le dépôt du projet sur <code>GitHub</code> / <code>Gitlab</code> (<code>remote</code>) a-t-il été modifié ?</p>
</section>
<section id="application-2" class="slide level2 smaller" data-background-image="background.svg" data-background-size="contain">
<h2>Application 2</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Interactions avec le dépôt distant</strong></p>
</div>
<div class="callout-content">
<ol type="1">
<li>Effectuer un <code>push</code> pour intégrer les changements locaux au projet distant</li>
<li>Parcourir l’historique du projet sur <code>GitHub</code> / <code>Gitlab</code>
<ol type="a">
<li>Faire apparaître les différences entre deux versions consécutives du projet</li>
<li>Afficher une version passée du projet</li>
</ol></li>
</ol>
</div>
</div>
</div>
</section>
<section id="bonnes-pratiques" class="slide level2 smaller" data-auto-animate="true" data-background-image="background.svg" data-background-size="contain">
<h2 data-id="quarto-animate-title">Bonnes pratiques</h2>
<p><strong>Que versionne-t-on ?</strong></p>
<ul>
<li class="fragment">Essentiellement du <span class="orange"><strong>code source</strong></span></li>
<li class="fragment"><span class="orange"><strong>Pas d’outputs</strong></span> (fichiers <code>.html</code>, <code>.pdf</code>, modèles…)</li>
<li class="fragment"><span class="orange"><strong>Pas de données</strong></span>, d’informations locales ou sensibles</li>
</ul>
<div class="fragment">
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Note</strong></p>
</div>
<div class="callout-content">
<p>Pour définir des règles qui évitent de <em>committer</em> tel ou tel fichier, on utilise un fichier nommé <strong><code>.gitignore</code></strong>.</p>
<p>Si on mélange du code et des éléments annexes (<em>output</em>, données…) dans un même dossier, il <span class="orange"><strong>faut consacrer du temps à ce fichier</strong></span>.</p>
<p>Des modèles de <code>.gitignore</code> existent sur internet, par exemple <a href="https://www.toptal.com/developers/gitignore">celui-ci</a> pour les projets <i class="fa-brands fa-r-project" aria-label="r-project"></i>.</p>
<p>N’hésitez pas à y ajouter des règles conservatrices (par exemple <code>*.csv</code>), comme cela est expliqué dans <a href="https://book.utilitr.org/03_Fiches_thematiques/Fiche_git_utilisation.html#gitignore">la documentation <code>utilitR</code></a>.</p>
</div>
</div>
</div>
</div>
</section>
<section id="bonnes-pratiques-1" class="slide level2 smaller" data-auto-animate="true" data-background-image="background.svg" data-background-size="contain">
<h2 data-id="quarto-animate-title">Bonnes pratiques</h2>
<p><strong>Format des commits</strong></p>
<div class="quarto-layout-panel" data-layout="[40,60]">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 40.0%;justify-content: flex-start;">
<ul>
<li class="fragment"><span class="orange"><strong>Fréquence</strong></span>
<ul>
<li class="fragment">Aussi souvent que possible</li>
<li class="fragment">Le lot de modifications doit “avoir du sens”</li>
</ul></li>
<li class="fragment"><span class="orange"><strong>Messages</strong></span>
<ul>
<li class="fragment">Courts et informatifs (comme un titre de mail)</li>
<li class="fragment">Décrire <strong>le pourquoi plutôt que le comment</strong> dans le texte</li>
</ul></li>
</ul>
</div>
<div class="quarto-layout-cell" style="flex-basis: 60.0%;justify-content: center;">
<p><img data-src="img/titre-commit.png"></p>
</div>
</div>
</div>
</section>
<section id="application-3" class="slide level2 smaller" data-background-image="background.svg" data-background-size="contain">
<h2>Application 3</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Le fichier <code>.gitignore</code></strong></p>
</div>
<div class="callout-content">
<p>L’objectif de cette application est de créer le fichier <code>.gitignore</code>, qui permet de spécifier l’ensemble des fichiers et/ou dossiers que l’on souhaite exclure de l’indexation faite par <code>Git</code>. Il doit se situer à la racine du projet.</p>
<ol type="1">
<li>S’il n’existe pas, créer un fichier texte nommé <code>.gitignore</code> <strong>à la racine du projet</strong> (attention à ne pas ajouter d’extension au fichier, type <code>.txt</code>)</li>
<li>Créer un dossier <code>data</code> à la racine du projet et créer à l’intérieur de celui-ci un fichier <code>data/raw.csv</code> avec une ligne de données quelconque</li>
<li>Ajouter une première règle au fichier <code>.gitignore</code> qui exclue le dossier <code>data/</code>, et vérifier que la règle fonctionne</li>
<li>Ajouter une seconde règle excluant tous les fichiers de type <code>*.pdf</code> et <code>*.html</code>, et vérifier que la règle fonctionne</li>
</ol>
</div>
</div>
</div>
<p>❓ <strong>Question</strong> : que se passe-t-il lorsque l’on ajoute au <code>.gitignore</code> des fichiers qui ont déjà été <em>commit</em> sur le projet Git ?</p>
<div class="fragment">
<div class="callout callout-note no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Des fichiers <code>.gitignore</code> standards</strong></p>
</div>
<div class="callout-content">
<p>Dans cette application, nous avons généré le fichier <code>.gitignore</code> manuellement. En pratique, il existe des <a href="https://github.com/github/gitignore/tree/main">.gitignore standards</a> adaptés pour chaque langage de programmation, qui implémentent déjà de nombreuses règles pertinentes. Le mieux est donc de partir du <a href="https://github.com/github/gitignore/blob/main/R.gitignore">.gitignore R</a> pour tout nouveau projet <code>R</code>, et de rajouter les règles spécifiques que l’on souhaite appliquer au projet.</p>
</div>
</div>
</div>
</div>
</section></section>
<section>
<section id="iii--le-travail-collaboratif-avec-git" class="title-slide slide level1 center" data-background-image="background.svg" data-background-size="contain">
<h1>III- Le travail collaboratif avec Git</h1>

</section>
<section id="outils-pour-le-travail-collaboratif" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Outils pour le travail collaboratif</h2>
<ul>
<li class="fragment">L’éco-système <code>Git</code> <span class="blue2"><strong>facilite</strong> le travail collaboratif</span>
<ul>
<li class="fragment"><code>Git</code> <i class="fa-brands fa-git-alt" aria-label="git-alt"></i> : modèle des <span class="orange"><strong>branches</strong></span></li>
<li class="fragment"><code>GitHub</code> <i class="fa-brands fa-github" aria-label="github"></i> / <code>GitLab</code> <i class="fa-brands fa-gitlab" aria-label="gitlab"></i> : <span class="orange"><strong>Issues</strong>, <strong>Pull Requests</strong>, <strong>Forks</strong></span></li>
</ul></li>
<li class="fragment">Ces outils ne remplacent pas une <span class="orange"><strong>bonne définition de l’organisation du travail</strong></span> en équipe
<ul>
<li class="fragment">Choix d’un <em>workflow</em></li>
<li class="fragment">Droits d’accès</li>
<li class="fragment">Règles de contribution</li>
</ul></li>
</ul>
</section>
<section id="application-4" class="slide level2 smaller" data-background-image="background.svg" data-background-size="contain">
<h2>Application 4</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Synchronisation des dépôts</strong></p>
</div>
<div class="callout-content">
<ol type="1">
<li>Se mettre par <span class="orange"><strong>groupes de 3/4 personnes</strong></span>:
<ul>
<li>Une personne aura la responsabilité d’être <span class="blue2"><strong>mainteneur</strong></span></li>
<li>Deux à trois personnes seront <span class="blue2"><strong>développeurs</strong></span></li>
</ul></li>
<li>Le mainteneur crée un dépôt sur <code>Github</code> / <code>Gitlab</code>. Il/Elle donne des droits au(x) développeur(s) du projet</li>
<li>Créer une copie locale (clone) du projet sur son service <code>RStudio</code></li>
<li>Créer un fichier <code>&lt;votre_nom&gt;-&lt;votre_prenom&gt;.md</code>. Écrire dedans trois phrases de son choix sans ponctuation ni majuscules, puis <code>commit</code> et <code>push</code> les modifications</li>
<li><strong>À ce stade, une seule personne (la plus rapide) devrait ne pas avoir rencontré de rejet du <code>push</code>.</strong> C’est normal ! Le premier ayant fait un <code>push</code> a modifié le dépôt commun ; les autres doivent intégrer ces modifications dans leur version locale (<code>pull</code>) avant d’avoir le droit de proposer un changement.</li>
<li>Néanmoins, le <code>pull</code> renvoie également une erreur : <code>Git</code> ne parvient pas à résoudre la divergence d’historique. Essayons de comprendre le problème et les solutions possibles.</li>
</ol>
</div>
</div>
</div>
</section>
<section id="divergence-dhistoriques-cas-simple" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Divergence d’historiques : cas simple</h2>

<img data-src="img/ff.png" class="r-stretch"><ul>
<li class="fragment"><code>Git</code> résout le problème via un <span class="blue2"><strong><em>fast-forward merge</em></strong></span>
<ul>
<li class="fragment">Le commit distant est rajouté à l’historique local</li>
<li class="fragment">Les dépôts sont synchronisés</li>
</ul></li>
</ul>
</section>
<section id="divergence-dhistoriques-cas-compliqué" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Divergence d’historiques : cas compliqué</h2>

<img data-src="img/divergence.png" class="r-stretch"><ul>
<li class="fragment"><p><code>Git</code> ne peut pas résoudre de lui même la divergence</p></li>
<li class="fragment"><p>Deux stratégies possibles</p>
<ul>
<li class="fragment">Le <span class="blue2"><strong>merge</strong></span></li>
<li class="fragment">Le <span class="blue2"><strong>rebase</strong></span></li>
</ul></li>
</ul>
</section>
<section id="ère-possibilité-le-merge" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>1ère possibilité : le <em>merge</em></h2>

<img data-src="img/merge.png" class="r-stretch"><ul>
<li class="fragment"><code>Git</code> crée un <span class="blue2"><strong>commit de merge</strong></span>
<ul>
<li class="fragment">Comportement par défaut (jusqu’à récemment)</li>
</ul></li>
<li class="fragment"><span class="orange"><strong>Inconvénient</strong></span> : rend l’<span class="blue2"><strong>historique non-linéaire</strong></span> (<a href="https://www.atlassian.com/fr/git/tutorials/using-branches/git-merge">plus d’explications</a>)</li>
</ul>
</section>
<section id="ème-possibilité-le-rebase-12" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>2ème possibilité : le <em>rebase</em> (1/2)</h2>

<img data-src="img/rebase1.png" class="r-stretch"><ul>
<li class="fragment"><code>Git</code> effectue 3 étapes
<ul>
<li class="fragment">Supprime temporairement le commit local</li>
<li class="fragment">Réalise un <em>fast-forward merge</em></li>
<li class="fragment">Rajoute le commit local au bout de l’historique</li>
</ul></li>
</ul>
</section>
<section id="ème-possibilité-le-rebase-22" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>2ème possibilité : le <em>rebase</em> (2/2)</h2>

<img data-src="img/rebase2.png" class="r-stretch"><ul>
<li class="fragment"><p><span class="orange"><strong>Avantage</strong></span> : l’historique reste <span class="blue2"><strong>linéaire</strong></span></p></li>
<li class="fragment"><p><span class="orange"><strong>Attention</strong></span> : ne jamais <em>rebase</em> des commits déjà poussés sur un dépôt public (<a href="https://git-scm.com/book/fr/v2/Les-branches-avec-Git-Rebaser-Rebasing#s_rebase_peril">plus d’explications</a>)</p></li>
</ul>
</section>
<section id="application-4-1" class="slide level2 smaller" data-background-image="background.svg" data-background-size="contain">
<h2>Application 4</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Synchronisation des dépôts</strong></p>
</div>
<div class="callout-content">
<ol start="7" type="1">
<li>Dans notre cas, on va conserver le précédent défaut (le <em>commit</em> de <em>merge</em>). Comme l’interface <code>RStudio</code> ne permet pas (encore) de sélectionner la stratégie de <code>pull</code>, on va préciser la configuration voulue via une commande passée dans le terminal
<ul>
<li><code>git config pull.rebase false</code></li>
</ul></li>
<li>Pour ceux dont le <code>push</code> a été refusé, effectuer un <code>pull</code> des modifications distantes via l’interface <code>RStudio</code></li>
<li>Effectuer à nouveau un <code>push</code> de vos modifications locales</li>
<li>Les derniers membres du groupe devront refaire les étapes précédentes, potentiellement plusieurs fois, pour pouvoir <code>push</code> leurs modifications locales</li>
</ol>
</div>
</div>
</div>
<p>❓ <strong>Question</strong> : que se serait-il passé si les différents membres du groupe avaient effectué leurs modifications sur un seul et même fichier ?</p>
</section>
<section id="application-5" class="slide level2 smaller" data-background-image="background.svg" data-background-size="contain">
<h2>Application 5</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Résoudre les conflits</strong></p>
</div>
<div class="callout-content">
<ol type="1">
<li>On se place dans la même configuration que dans l’application précédente : un <span class="blue2"><strong>mainteneur</strong></span> et deux/trois <span class="blue2"><strong>développeurs</strong></span></li>
<li>Le mainteneur modifie le contenu de son fichier, puis <code>commit</code> et <code>push</code> les modifications</li>
<li>Sans faire de <code>pull</code> préalable, les développeurs modifient également le contenu du fichier du mainteneur, puis <code>commit</code> et <code>push</code> les modifications</li>
<li>Le <code>push</code> est rejeté pour la même raison que dans l’application précédente : les dépôts ne sont plus synchronisés, il faut <code>pull</code> les changements distants au préalable. Mais <strong>cette fois, le <code>pull</code> est également rejeté</strong> : il y a un <strong>conflit</strong> entre l’historique du projet distant et celui du projet local. <code>Git</code> nous indique qu’il faut résoudre le conflit avant de pouvoir modifier l’historique du projet.</li>
<li>Utiliser l’interface de <code>RStudio</code> pour résoudre le conflit, en choisissant la version du fichier que vous souhaitez conserver, puis <code>commit</code>/<code>push</code> les modifications</li>
<li>Comme dans l’application précédente, seul le développeur le plus rapide parvient à <code>push</code>. Les autres doivent répéter l’opération.</li>
</ol>
</div>
</div>
</div>
<p>❓ <strong>Question</strong> : comment limiter au maximum la survenue des conflits d’historique ?</p>
</section>
<section id="le-modèle-des-branches" class="slide level2" data-auto-animate="true" data-background-image="background.svg" data-background-size="contain">
<h2 data-id="quarto-animate-title">Le modèle des branches</h2>

<img data-src="https://i.imgflip.com/4ooord.jpg" class="quarto-figure quarto-figure-center r-stretch"></section>
<section id="le-modèle-des-branches-1" class="slide level2" data-auto-animate="true" data-background-image="background.svg" data-background-size="contain">
<h2 data-id="quarto-animate-title">Le modèle des branches</h2>

<img data-src="img/branches.png" class="r-stretch"></section>
<section id="exemple-dorganisation-le-github-flow" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Exemple d’organisation : le <em>GitHub flow</em></h2>

<img data-src="img/ghflow.png" class="r-stretch"><p>Description plus détaillée : <a href="https://docs.github.com/en/get-started/quickstart/github-flow">ici</a></p>
</section>
<section id="application-6" class="slide level2 smaller" data-background-image="background.svg" data-background-size="contain">
<h2>Application 6</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Branches, <em>issues</em> et <em>pull requests</em></strong></p>
</div>
<div class="callout-content">
<ol type="1">
<li>Sur <code>Github</code> / <code>Gitlab</code>, chaque personne ouvre une <code>Issue</code> sur le même dépôt que les applications précédentes, dans laquelle vous suggérez une modification à apporter à votre projet</li>
<li>Créer une branche dont le nom indique la modification que vous allez apporter (ex : <code>ajout-authentification</code>)</li>
<li>Effectuer un <code>commit</code> avec les modifications de votre choix, puis pousser les changements sur une nouvelle branche du dépôt distant</li>
<li>Ouvrir une <code>Pull Request</code> (<code>PR</code>) pour proposer d’intégrer vos changements sur la branche principale du dépôt distant. Spécifier que l’acceptation de la <code>Pull Request</code> entraînera la fermeture automatique de l’<code>Issue</code> associée en écrivant dans le corps de la <code>PR</code> : <code>close #N</code> où <code>N</code> est le numéro de l’<code>Issue</code> en question</li>
<li>Chaque personne effectue finalement une <em>review</em> d’une <code>PR</code> d’un autre membre de l’équipe, suite à quoi les différentes <code>PR</code> peuvent être fusionnées</li>
</ol>
</div>
</div>
</div>
<p>❓ <strong>Question</strong> : quelle organisation pour merge dans la branche principale ?</p>
</section>
<section id="application-7" class="slide level2 smaller" data-background-image="background.svg" data-background-size="contain">
<h2>Application 7</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Contribuer à un projet collaboratif</strong></p>
</div>
<div class="callout-content">
<p>L’objectif de cette application est d’initier au mode de contribution à un dépôt collaboratif. Concrètement, vous allez ouvrir une <code>Issue</code> sur un dépôt d’un autre développeur, en proposant des modifications. Puis, comme vous êtes très motivés, vous allez soumettre une <code>Pull Request</code> qui propose une solution à l’<code>Issue</code>.</p>
<ol type="1">
<li>Ouvrir une <code>Issue</code> sur le dépôt <a href="https://github.com/avouacr/git-exo.git"><code>git-exo</code></a> en suggérant une modification à apporter au fichier <code>README.md</code></li>
<li>Sur <code>GitHub</code>, faire un <code>Fork</code> du dépôt <a href="https://github.com/avouacr/git-exo.git"><code>git-exo</code></a></li>
<li>Créer une branche portant un nom pertinent au vu de la modification que vous voulez apporter</li>
<li>Effectuer un <code>commit</code> avec les modifications de votre choix, puis pousser les changements sur votre <code>Fork</code></li>
<li>Ouvrir une <code>Pull Request</code> (<code>PR</code>) pour proposer d’intégrer vos changements dans la branche principale (<code>main</code>) du dépôt <a href="https://github.com/avouacr/git-exo.git"><code>git-exo</code></a></li>
<li>Dans le corps de votre <code>PR</code>, indiquez <code>close #N</code> où <code>N</code> est le numéro de votre <code>Issue</code>. Comme ça, lorsque la <code>PR</code> sera acceptée, l’<code>Issue</code> initiale sera automatiquement fermée !</li>
</ol>
</div>
</div>
</div>
<p>❓ <strong>Question</strong> : pourquoi, avec un <code>fork</code>, est-il très important de toujours effectuer une <code>Pull Request</code> à partir d’une branche différente de la branche principale ?</p>
</section>
<section id="ressources-supplémentaires" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Ressources supplémentaires</h2>
<ul>
<li class="fragment"><p>La <a href="https://book.utilitr.org/">documentation <code>utilitR</code></a> propose plusieurs chapitres sur <code>Git</code></p></li>
<li class="fragment"><p>Cours <a href="https://ensae-reproductibilite.github.io/website/">Reproductibilité et bonnes pratiques pour les projets de data science</a> de l’<code>ENSAE</code></p></li>
<li class="fragment"><p>La <a href="https://git-scm.com/book/en/v2">Bible</a> de l’usage de <code>Git</code></p></li>
</ul>
</section></section>
<section>
<section id="partie-2-bonnes-pratiques-avec-r" class="title-slide slide level1 center" data-background-image="background.svg" data-background-size="contain">
<h1>Partie 2 : bonnes pratiques avec <code>R</code></h1>

</section>
<section id="plan-de-la-partie-1" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Plan de la partie</h2>
<p><span class="emoji" data-emoji="one">1️⃣</span> Qualité du code</p>
<p><span class="emoji" data-emoji="two">2️⃣</span> Structure des projets</p>
<p><span class="emoji" data-emoji="three">3️⃣</span> Formats de données</p>
<p><span class="emoji" data-emoji="four">4️⃣</span> Environnements reproductibles</p>
<p><span class="emoji" data-emoji="five">5️⃣</span> <code>R</code> en production</p>
</section>
<section id="application-0-1" class="slide level2 smaller" data-background-image="background.svg" data-background-size="contain">
<h2>Application 0</h2>
<div class="panel-tabset">
<ul id="tabset-3" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-3-1"><i class="fa-brands fa-github" aria-label="github"></i></a></li><li><a href="#tabset-3-2"><i class="fa-brands fa-gitlab" aria-label="gitlab"></i> insee</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1">
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Préparation de l’environnement de travail</strong></p>
</div>
<div class="callout-content">
<ol type="1">
<li>Créer un dépôt sur <code>Github</code> <i class="fa-brands fa-github" aria-label="github"></i> en <strong>incluant un fichier <code>README</code></strong> et un <code>.gitignore</code> (chercher le modèle <code>R</code> dans les suggestions)</li>
<li>Lancer un service <code>RStudio</code>. Dans l’onglet de configuration <code>Git</code> du service, fixer la durée du <code>Cache</code> pour le stockage des identifiants <code>GitHub</code> à une valeur suffisamment élevée (conseil: 36000)</li>
<li>Cloner le dépôt distant sur votre environnement local (ici, le <code>RStudio</code> du <code>Datalab</code>):
<ul>
<li><code>File</code> → <code>New project</code> → <code>Version Control</code> → <code>Git</code></li>
</ul></li>
<li>Créer un script <code>get_data.R</code> en copiant le contenu de <a href="https://raw.githubusercontent.com/InseeFrLab/formation-bonnes-pratiques-git-R/refs/heads/main/R/get_data.R">ce fichier</a>, puis l’exécuter</li>
<li>Créer le script <code>script.R</code> dans votre dépôt en copiant le contenu de <a href="https://raw.githubusercontent.com/InseeFrLab/formation-bonnes-pratiques-git-R/refs/heads/main/R/script.R">ce fichier</a>. <strong>Ne l’exécutez pas, c’est l’objet de l’exercice suivant</strong>.</li>
<li>Ajouter la règle “RPindividus*” au fichier <code>.gitignore</code>. Que signifie-t-elle ?</li>
<li><em>Commit</em>/<em>push</em> les changements (tous les fichiers, y compris ceux que <code>Git</code> a ajouté)</li>
</ol>
</div>
</div>
</div>
</div>
<div id="tabset-3-2">
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Préparation de l’environnement de travail</strong></p>
</div>
<div class="callout-content">
<ol type="1">
<li>Créer un nouveau dépôt public sur <code>GitLab</code></li>
<li>Lancer un service <code>RStudio</code>. Dans l’onglet de configuration <code>Git</code> du service, fixer la durée du <code>Cache</code> pour le stockage des identifiants <code>GitLab</code> à une valeur suffisamment élevée</li>
<li>Cloner le dépôt distant sur votre environnement local (ici, le <code>RStudio</code> de <code>LS3</code>):
<ul>
<li><code>File</code> → <code>New project</code> → <code>Version Control</code> → <code>Git</code></li>
</ul></li>
<li>Créer un script <code>get_data.R</code> en copiant le contenu de <a href="https://raw.githubusercontent.com/InseeFrLab/formation-bonnes-pratiques-git-R/main/R/get_data_ls3.R">ce fichier</a>, puis l’exécuter</li>
<li>Créer le script <code>script.R</code> dans votre dépôt en copiant le contenu de <a href="https://raw.githubusercontent.com/InseeFrLab/formation-bonnes-pratiques-git-R/main/R/script.R">ce fichier</a></li>
<li>Ajouter la règle “individu_reg.*” au fichier <code>.gitignore</code>. Que signifie-t-elle ?</li>
<li><em>Commit</em>/<em>push</em> les changements</li>
</ol>
</div>
</div>
</div>
</div>
</div>
</div>
</section></section>
<section>
<section id="i--qualité-du-code" class="title-slide slide level1 center" data-background-image="background.svg" data-background-size="contain">
<h1>I- Qualité du code</h1>

</section>
<section id="enjeux" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Enjeux</h2>
<ul>
<li class="fragment"><p>D’une vision utilitariste du code à une vision du code comme <span class="orange"><strong>outil de communication</strong></span></p></li>
<li class="fragment"><p>Favoriser la <span class="orange"><strong>lisibilité</strong></span> et la <span class="orange"><strong>maintenabilité</strong></span></p></li>
<li class="fragment"><p>Faciliter la <span class="orange"><strong>réutilisation</strong></span></p></li>
<li class="fragment"><p>Assurer la <span class="orange"><strong>transparence</strong></span> méthodologique</p></li>
</ul>
</section>
<section id="principes-généraux" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Principes généraux</h2>
<p><span class="emoji" data-emoji="one">1️⃣</span> Adopter les <span class="orange"><strong>standards communautaires</strong></span></p>
<p><span class="emoji" data-emoji="two">2️⃣</span> Eviter la <span class="orange"><strong>duplication de code</strong></span></p>
<p><span class="emoji" data-emoji="three">3️⃣</span> <span class="orange"><strong>(Auto)-documenter</strong></span> son code</p>
<p><span class="emoji" data-emoji="four">4️⃣</span> Isoler la <span class="orange"><strong>configuration</strong></span> du code</p>
</section>
<section id="adopter-les-standards-communautaires" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2><span class="emoji" data-emoji="one">1️⃣</span> Adopter les standards communautaires</h2>
<blockquote>
<p><em>“Good coding style is like correct punctuation: you can manage without it, butitsuremakesthingseasiertoread”</em></p>
<p><a href="https://style.tidyverse.org/">Tidyverse Style Guide</a></p>
</blockquote>
<ul>
<li class="fragment"><p>Respecter les <span class="orange">conventions</span> du langage dans lequel il est rédigé</p></li>
<li class="fragment"><p>Il existe un <strong>guide de référence</strong> pour bien coder en <code>R</code> : le <a href="https://style.tidyverse.org/index.html">Tidyverse style guide</a>.</p></li>
</ul>
</section>
<section id="adopter-les-standards-communautaires-1" class="slide level2 smaller" data-background-image="background.svg" data-background-size="contain">
<h2><span class="emoji" data-emoji="one">1️⃣</span> Adopter les standards communautaires</h2>
<p>Deux outils pratiques aident à respecter les standards :</p>
<ol type="1">
<li class="fragment"><span class="orange"><strong><em>linter</em></strong></span> : programme qui vérifie que le code est <strong>formellement</strong> conforme à un certain <em>guidestyle</em>
<ul>
<li class="fragment">signale problèmes formels, sans corriger</li>
</ul></li>
<li class="fragment"><span class="orange"><strong><em>formatter</em></strong></span> : programme qui reformate un code pour le rendre conforme à un certain <em>guidestyle</em>
<ul>
<li class="fragment">modifie directement le code</li>
</ul></li>
</ol>
<div class="fragment">
<div class="callout callout-tip callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Astuce</strong></p>
</div>
<div class="callout-content">
<ul>
<li><span class="blue2">Exemples d’erreurs repérées</span> par un <em>linter</em> :
<ul>
<li>lignes de code trop longues ou mal indentées, parenthèses non équilibrées, noms de fonctions mal construits…</li>
</ul></li>
<li><span class="blue2">Exemples d’erreurs <strong>non</strong> repérées</span> par un <em>linter</em> :
<ul>
<li>fonctions mal utilisées, arguments mal spécifiés, structure du code incohérente, code insuffisamment documenté…</li>
</ul></li>
</ul>
</div>
</div>
</div>
</div>
</section>
<section id="adopter-les-standards-communautaires-2" class="slide level2 smaller" data-background-image="background.svg" data-background-size="contain">
<h2><span class="emoji" data-emoji="one">1️⃣</span> Adopter les standards communautaires</h2>
<p><br></p>
<p>Dans le cas de <i class="fa-brands fa-r-project" aria-label="r-project"></i> :</p>
<ul>
<li class="fragment">le <span class="orange"><em>linter</em></span> à utiliser est le <em>package</em> <a href="https://github.com/r-lib/lintr"><code>lintr</code></a></li>
<li class="fragment">le <span class="orange"><em>formatter</em></span> à utiliser est le <em>package</em> <a href="https://github.com/r-lib/styler"><code>styler</code></a>.
<ul>
<li class="fragment">Existe également le <em>package</em> <a href="https://github.com/yihui/formatR"><code>formatR</code></a>.</li>
</ul></li>
</ul>
</section>
<section id="utiliser-des-fonctions" class="slide level2 smaller" data-background-image="background.svg" data-background-size="contain">
<h2><span class="emoji" data-emoji="two">2️⃣</span> Utiliser des fonctions</h2>
<div class="callout callout-important callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Règle d’or</strong></p>
</div>
<div class="callout-content">
<p>Il faut utiliser une <span class="red2"><strong>fonction</strong></span> dès qu’on utilise une même portion de code plus de deux fois (<span class="red2"><strong><em>don’t repeat yourself</em> (DRY)</strong></span>)</p>
</div>
</div>
</div>
<ul>
<li class="fragment"><span class="orange">Limite les risques d’erreurs</span> liés aux copier/coller</li>
<li class="fragment">Rend le code <span class="orange">plus lisible</span> et <span class="orange">plus compact</span></li>
<li class="fragment"><span class="orange">Un seul endroit</span> du code à modifier lorsqu’on souhaite modifier le traitement</li>
<li class="fragment">Facilite la <span class="orange">réutilisation</span> et la <span class="orange">documentation</span> du code !</li>
</ul>
<div class="fragment">
<div class="callout callout-tip callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Règles pour écrire des fonctions <strong>pertinentes</strong></strong></p>
</div>
<div class="callout-content">
<ul>
<li>Une tâche = une fonction</li>
<li>Une tâche complexe = un enchaînement de fonctions réalisant chacune une tâche simple</li>
<li>Limiter l’utilisation de variables globales.</li>
</ul>
</div>
</div>
</div>
</div>
</section>
<section id="documenter-son-code" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2><span class="emoji" data-emoji="three">3️⃣</span> Documenter son code</h2>
<ul>
<li class="fragment">Grands principes :
<ul>
<li class="fragment">Documenter le <span class="orange"><strong>pourquoi</strong></span> plutôt que le <span class="orange"><strong>comment</strong></span></li>
<li class="fragment">Privilégier l’<span class="orange"><strong>auto-documentation</strong></span></li>
</ul></li>
</ul>
<div class="fragment">
<div class="callout callout-tip callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Comment bien documenter un script ?</strong></p>
</div>
<div class="callout-content">
<ul>
<li><span class="orange"><strong>Minimum</strong></span> 🚦 : commentaire au début du script pour décrire ce qu’il fait</li>
<li><span class="orange"><strong>Bien</strong></span> 👍 : commenter les parties “délicates” du code</li>
<li><span class="orange"><strong>Idéal</strong></span> 💪 : documenter ses fonctions avec la syntaxe <code>roxygen2</code>.</li>
</ul>
</div>
</div>
</div>
</div>
</section>
<section id="documenter-son-code-1" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2><span class="emoji" data-emoji="three">3️⃣</span> Documenter son code</h2>
<div class="callout callout-tip callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>L’auto-documentation en pratique</strong></p>
</div>
<div class="callout-content">
<p>👎 La documentation pallie des mauvais nommages</p>
<pre><code># Utilise string si x est non manquant et non vide
if (!is.na(x) &amp;&amp; nzchar(x)) {
  use_string(x)
}</code></pre>
<p>👍 Les nommages suffisent à comprendre le code</p>
<pre><code>x_is_not_empty_string &lt;- (!is.na(x) &amp;&amp; nzchar(x))
if (x_is_not_empty_string) {
  use_string(x)
}</code></pre>
</div>
</div>
</div>
</section>
<section id="isoler-la-configuration-du-code" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2><span class="emoji" data-emoji="four">4️⃣</span> Isoler la configuration du code</h2>
<ul>
<li class="fragment">Rappel : on vise une structure <span class="orange"><strong>modulaire</strong></span></li>
</ul>
<div class="fragment">
<p><img data-src="img/environment_clean.png"></p>
<ul>
<li class="fragment">En pratique : <span class="orange"><strong>isoler</strong></span> les <span class="blue2"><strong>packages</strong></span> et les <span class="blue2"><strong>secrets</strong></span></li>
</ul>
</div>
</section>
<section id="gestion-des-packages" class="slide level2 smaller" data-background-image="background.svg" data-background-size="contain">
<h2><span class="emoji" data-emoji="four">4️⃣</span> Gestion des packages</h2>
<ul>
<li class="fragment"><span class="orange"><strong>Externaliser</strong></span> l’installation des packages nécessaires
<ul>
<li class="fragment">Le code ne doit <span class="blue2"><strong>pas modifier l’environnement</strong></span></li>
<li class="fragment"><span class="blue2"><strong>Où ?</strong></span> Dans le <code>README</code> ou des fichiers spécialisés (<code>DESCRIPTION</code> ou <code>renv.lock</code>)</li>
</ul></li>
<li class="fragment"><span class="orange"><strong>Expliciter</strong></span> l’appel des packages avec la syntaxe <code>package::fonction()</code>
<ul>
<li class="fragment">Favorise la <span class="blue2"><strong>lisibilité</strong></span> du code</li>
<li class="fragment">Limite les risques de <span class="blue2"><strong>fonctions “masquées”</strong></span></li>
</ul></li>
</ul>
<div class="fragment">
<div class="callout callout-tip callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Exemple</strong></p>
</div>
<div class="callout-content">
<ul>
<li><code>package1</code> et <code>package2</code> contiennent chacun une fonction appelée <code>super_fonction</code>.</li>
<li>Si <code>package2</code> est chargé après <code>package1</code>, alors la fonction de <code>package1</code> est automatiquement masquée et <code>super_fonction</code> désigne par défaut la fonction de <code>package2</code>.</li>
<li>Mieux vaut noter <code>package1::superFonction</code> et <code>package2::superFonction</code></li>
</ul>
</div>
</div>
</div>
</div>
</section>
<section id="gestion-des-secrets" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2><span class="emoji" data-emoji="four">4️⃣</span> Gestion des secrets</h2>
<ul>
<li class="fragment"><p>Les <span class="orange"><strong>secrets</strong></span> (mots de passe, <em>tokens</em>, etc.) sont des <span class="orange"><strong>données sensibles</strong></span></p></li>
<li class="fragment"><p>Quelques <span class="orange"><strong>principes de sécurité</strong></span> essentiels</p>
<ul>
<li class="fragment">Utiliser des <span class="blue2"><strong><em>tokens</em></strong></span> plutôt que des mots de passe</li>
<li class="fragment">Utiliser des <span class="blue2"><strong>comptes de service</strong></span> (quand c’est possible)</li>
<li class="fragment">Jamais de <span class="blue2"><strong>secrets en clair</strong></span> dans le code</li>
</ul></li>
<li class="fragment"><p>En pratique, deux <span class="orange"><strong>recommendations selon l’usage</strong></span></p>
<ul>
<li class="fragment"><span class="blue2"><strong>Demander interactivement</strong></span> le secret à l’utilisateur</li>
<li class="fragment">Spécifier des <span class="blue2"><strong>variables d’environnement</strong></span> via le <a href="https://book.utilitr.org/01_R_Insee/Fiche-personnaliser-R.html#le-fichier-.renviron">fichier .Renviron</a> (⚠️ à ajouter au <code>.gitignore</code>)</li>
</ul></li>
</ul>
</section>
<section id="ressources-supplémentaires-1" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Ressources supplémentaires</h2>
<p><br></p>
<ul>
<li class="fragment">Une <a href="https://jolicode.netlify.app/">présentation</a> de Maëlle Salmon sur le « code beau ».</li>
<li class="fragment">Une <a href="https://mitmat.github.io/slides/2022-05-26-egu/code-data-open-science.html#1">présentation très complète</a> sur le partage de code et de données avec <code>R</code></li>
<li class="fragment">Une <a href="https://cran.r-project.org/web/packages/httr/vignettes/secrets.html">documentation</a> (en anglais) sur la gestion des secrets (<em>tokens</em>, mots de passe, etc.)</li>
</ul>
</section>
<section id="application-1-1" class="slide level2 smaller nonincremental" data-background-image="background.svg" data-background-size="contain">
<h2>Application 1</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Partie 1 : vérification du bon fonctionnement du code</strong></p>
</div>
<div class="callout-content">
<p>Un code reproductible est avant toute chose un code fonctionnel !</p>
<ul>
<li class="fragment">Repérez les erreurs qui empêchent le script <code>script.R</code> de s’exécuter correctement, et les corriger.</li>
<li class="fragment">Redémarrer votre session avec <code>Session</code> &gt; <code>New Session</code> (ou <kbd>Ctrl</kbd>+<kbd>Maj</kbd>+<kbd>F10</kbd>) et refaire tourner le code de A à Z. Avez-vous une erreur ?</li>
</ul>
</div>
</div>
</div>
<div class="callout callout-important callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Les pièges que cet exercice vous montre</strong></p>
</div>
<div class="callout-content">
<ul>
<li>Les fonctions utilisées sans import des <em>packages</em></li>
<li>Les chemins et le <em>working directory</em></li>
<li>L’ordre des imports</li>
<li>Les mauvaises pratiques de gestion de l’environnement (les bonnes pratiques arrivent dans les prochains exercices !)</li>
</ul>
</div>
</div>
</div>
</section>
<section id="application-1-2" class="slide level2 smaller nonincremental" data-background-image="background.svg" data-background-size="contain">
<h2>Application 1</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Partie 2 : premiers standards de qualité</strong></p>
</div>
<div class="callout-content">
<ol type="1">
<li>Installer les <em>packages</em> <code>R</code> <a href="https://github.com/r-lib/lintr"><code>lintr</code></a> et <a href="https://github.com/r-lib/styler"><code>styler</code></a><sup>1</sup>.</li>
<li>Définir le <em>linter</em> à utiliser comme étant de type <code>tidyverse</code> avec <code>lintr::use_lintr(type = "tidyverse")</code></li>
<li>Diagnostiquer le script <code>script.R</code> avec <code>lintr::lint("script.R")</code>.
<ul>
<li>Comprenez-vous la nature des problèmes détectés par le <em>linter</em>?</li>
</ul></li>
<li>Appliquer le <em>formatter</em> au <code>script.R</code> avec <code>styler::style_file("script.R")</code>.</li>
<li>Refaire tourner le <em>linter</em>. Il reste encore un certain nombre d’erreurs de formattage, car <code>styler</code> est un <em>formatter</em> peu intrusif.</li>
<li>Regarder les problèmes restants repérés par le <em>linter</em>, et en corriger quelques uns (un pour chaque type de problème).</li>
</ol>
</div>
</div>
</div>
<aside><ol class="aside-footnotes"><li id="fn1"><p>Les <code>install.packages</code> sont à faire en console et ne doivent pas être mis dans le script (justification dans la prochaine partie de cet exercice).</p></li></ol></aside></section>
<section id="application-1-3" class="slide level2 smaller nonincremental" data-background-image="background.svg" data-background-size="contain">
<h2>Application 1</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Partie 3 : une meilleure gestion des <em>packages</em> utilisés</strong></p>
</div>
<div class="callout-content">
<ol type="1">
<li>Limiter les ambiguités sur les <em>packages</em> en utilisant la syntaxe <code>package::fonction</code> pour les <em>packages</em> rarement utilisés dans le script.</li>
<li>L’installation des <em>packages</em> dans un script n’est pas une bonne pratique. Supprimer les instructions correspondantes.</li>
<li>Importer le <code>tidyverse</code> au complet est rarement utile. N’importer à la place que les <em>packages</em> effectivement utilisés dans le script.</li>
</ol>
<details>
<summary>
<p>A propos du <code>rm(list = ls())</code> (le supprimer !)</p>
</summary>
<p>Cette commande est une mauvaise pratique.</p>
<p>On la retrouve encore dans trop de scripts car elle est utilisée pour de mauvaises raisons. Elle ne remets pas à 0 votre environnement: elle supprime juste les données de celui-ci, sans toucher au reste (packages importés, etc.).</p>
<p>Il vaut mieux gérer cela en changeant les options de <i class="fa-brands fa-r-project" aria-label="r-project"></i> puis redémarrer la session <i class="fa-brands fa-r-project" aria-label="r-project"></i> (<kbd>CTRL</kbd>+<kbd>SHIFT</kbd>+<kbd>F10</kbd>)</p>
<p><img data-src="img/rdata-setup.png"></p>
</details>
</div>
</div>
</div>
</section>
<section id="application-1-4" class="slide level2 smaller nonincremental" data-background-image="background.svg" data-background-size="contain">
<h2>Application 1</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Partie 4 : (auto-)documentation du code</strong></p>
</div>
<div class="callout-content">
<p>L’objectif de cet exercice est de remettre de l’ordre dans le script, cela le rendra bien plus lisible.</p>
<ol type="1">
<li>Déplacer les <code>library</code> pour les mettre tous ensemble au début du script.</li>
<li>Le script n’est pas construit dans un ordre logique. Déplacer les parties pour adopter une structure plus lisible :
<ul>
<li>Gestion de l’environnement -&gt; Définition de fonctions -&gt; Import des données -&gt; Retraitement des données -&gt; Statistiques descriptives -&gt; Graphiques -&gt; Modélisation</li>
</ul></li>
<li>Donner des titres aux parties/sous-parties en utilisant les standards de documentation reconnus par RStudio :
<ul>
<li><code># TITRE NIVEAU 1 ------------</code> et <code>## TITRE NIVEAU 2 ==========</code></li>
</ul></li>
</ol>
<p><em>Au passage, vous pouvez changer les noms de certains objets pour les rendre moins cryptiques (<code>df3</code> n’est pas très clair).</em></p>
</div>
</div>
</div>
</section>
<section id="application-1-5" class="slide level2 smaller nonincremental" data-background-image="background.svg" data-background-size="contain">
<h2>Application 1</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Partie 5 : une meilleure gestion des <span class="orange">secrets</span></strong></p>
</div>
<div class="callout-content">
<p>Dans cette application, on va explorer deux manières possibles de gérer les secrets proprement.</p>
<p><strong>Première possibilité</strong> : de manière <strong>interactive</strong>.</p>
<ol type="1">
<li>Repérer le jeton d’API dans le code et le retirer, en le stockant temporairement ailleurs.</li>
<li>Utiliser la fonction <a href="https://rdrr.io/cran/rstudioapi/man/askForPassword.html">askForPassword</a> du package <code>rstudioapi</code>, qui permet de demander à l’utilisateur d’entrer le secret à l’aide d’un pop-up interactif.</li>
<li>Vérifier le bon fonctionnement de la solution implémentée.</li>
</ol>
<p>⚠️ Cette solution nécessite l’exécution du code dans un environnement <code>RStudio</code>, ce qui implique un usage en <em>self</em>.</p>
<p><strong>Deuxième possibilité</strong> : via les <strong>variables d’environnement</strong>.</p>
<ol start="4" type="1">
<li>Supprimer la solution précédente (pop-up interactif) et redémarrer le <em>kernel R</em></li>
<li>Créer un fichier <code>.Renviron</code> (voir cette <a href="https://book.utilitr.org/01_R_Insee/Fiche-personnaliser-R.html#le-fichier-.renviron">fiche UtilitR</a> pour plus d’info sur ce fichier) à la racine du projet et y ajouter une ligne <code>JETON_API=xxx</code> en remplaçant <code>xxx</code> par la valeur du jeton.</li>
<li>Importer la valeur du jeton dans une variable <code>api_token</code> à l’aide de la fonction <a href="https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/Sys.getenv">Sys.getenv</a>.</li>
<li>Vérifier le bon fonctionnement de la solution implémentée.</li>
<li>Vérifier que l’exclusion du <code>.Renviron</code> est bien renseigné dans le <code>.gitignore</code>. Si ce n’est pas le cas, ajouter la règle et vérifier son bon fonctionnement, puis <em>commit</em>/<em>push</em>.</li>
</ol>
</div>
</div>
</div>
</section>
<section id="checkpoint" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Checkpoint</h2>
<div class="callout callout-caution callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Checkpoint</strong></p>
</div>
<div class="callout-content">
<ul>
<li>Le script <a href="https://raw.githubusercontent.com/InseeFrLab/formation-bonnes-pratiques-git-R/refs/heads/main/R/checkpoints/application1/script.R"><code>script.R</code></a></li>
<li>Le <a href="https://raw.githubusercontent.com/InseeFrLab/formation-bonnes-pratiques-git-R/refs/heads/main/R/checkpoints/application1/.gitignore"><code>.gitignore</code></a></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="checkpoint.jpg" class="quarto-figure quarto-figure-center" style="width:40.0%"></p>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="bilan" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Bilan</h2>
<div class="columns">
<div class="column" style="width:60%;">
<ul>
<li>Un code mal structuré
<ul>
<li>Limite la <span class="blue2"><strong>lisibilité du projet</strong></span></li>
<li>Est très <span class="blue2"><strong>coûteux à maintenir</strong></span> (dette technique)</li>
</ul></li>
<li>Les petits gestes peuvent économiser un temps précieux</li>
</ul>
</div><div class="column" style="width:40%;">
<div class="quarto-layout-panel" data-layout="[[-1], [1], [-1]]">
<div class="quarto-layout-row">
<div class="quarto-figure-spacer quarto-layout-cell" style="flex-basis: 100.0%;justify-content: flex-start;">
<p>&nbsp;</p>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="img/reproducibility-lazy-no-bg.png" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div>
</div>
</div>
</div></div>
</section></section>
<section>
<section id="ii--structure-des-projets" class="title-slide slide level1 center" data-background-image="background.svg" data-background-size="contain">
<h1>II- Structure des projets</h1>

</section>
<section id="enjeux-1" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Enjeux</h2>
<ol type="1">
<li class="fragment"><p>Favoriser la <span class="orange"><strong>lisibilité</strong></span> et la <span class="orange"><strong>maintenabilité</strong></span></p></li>
<li class="fragment"><p>Construire des projets <span class="orange"><strong>reproductibles</strong></span></p></li>
</ol>
</section>
<section id="a-ne-pas-reproduire-chez-vous" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2><span class="emoji" data-emoji="warning">⚠️</span> A ne pas reproduire chez vous</h2>
<p><br></p>
<pre><code>├── report.Rmd
├── correlation.png
├── data.csv
├── data2.csv
├── fig1.png
├── figure 2 (copy).png
├── report.pdf
├── partial data.csv
├── script.R
└── script_final.R</code></pre>
<p>Source : <a href="https://eliocamp.github.io/reproducibility-with-r/materials/day1/02-projects/">eliocamp.github.io</a></p>
</section>
<section id="principes-généraux-1" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Principes généraux</h2>
<ol type="1">
<li class="fragment"><p>Utiliser les <span class="orange"><strong>projets RStudio</strong></span></p></li>
<li class="fragment"><p>Organiser son projet en <span class="orange"><strong>sous-dossiers</strong></span></p></li>
<li class="fragment"><p>Donner des <span class="orange"><strong>noms pertinents</strong></span> aux fichiers</p></li>
<li class="fragment"><p><span class="orange"><strong>Documenter</strong></span> son projet</p></li>
<li class="fragment"><p>(Faire de son projet un <span class="orange"><strong>package</strong></span>)</p></li>
</ol>
</section>
<section id="utiliser-les-projets-rstudio" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2><span class="emoji" data-emoji="one">1️⃣</span> Utiliser les projets RStudio</h2>
<ul>
<li class="fragment"><span class="orange"><strong>Objectif</strong></span> : favoriser la <span class="blue2"><strong>reproductibilité</strong></span>
<ul>
<li class="fragment">Tous les fichiers nécessaires au projet dans un même dossier</li>
<li class="fragment">Le dossier contenant le projet RStudio est automatiquement utilisé comme <strong><em>working directory</em></strong></li>
<li class="fragment">Utilisation de <span class="blue2"><strong>chemins relatifs</strong></span> plutôt qu’absolus.</li>
</ul></li>
<li class="fragment"><strong>Bonus</strong> : en utilisant <code>Git</code>, on s’assure de toujours travailler dans un projet RStudio !</li>
</ul>
</section>
<section id="organiser-son-projet-en-sous-dossiers" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2><span class="emoji" data-emoji="two">2️⃣</span> Organiser son projet en sous-dossiers</h2>
<ul>
<li><span class="orange"><strong>Objectif</strong></span> : adopter une structure arbitraire, mais <span class="blue2"><strong>lisible</strong></span> et <span class="blue2"><strong>cohérente</strong></span></li>
</ul>
<pre><code>├── data
│   ├── raw
│   │   ├── data.csv
│   │   └── data2.csv
│   └── derived
│       └── partial data.csv
├── R
|   ├── script.R
│   ├── script_final.R
│   └── report.Rmd
└── output
    ├── fig1.png
    ├── figure 2 (copy).png
    ├── figure10.png
    ├── correlation.png
    └── report.pdf</code></pre>
</section>
<section id="donner-des-noms-pertinents-aux-fichiers" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2><span class="emoji" data-emoji="three">3️⃣</span> Donner des noms pertinents aux fichiers</h2>
<ul>
<li><span class="orange"><strong>Objectif</strong></span> : <span class="blue2"><strong>auto-documenter</strong></span> son projet</li>
</ul>
<pre><code>├── data
│   ├── raw
│   │   ├── dpe_logement_202103.csv
│   │   └── dpe_logement_202003.csv
│   └── derived
│       └── dpe_logement_merged_preprocessed.csv
├── R
|   ├── preprocessing.R
│   ├── generate_plots.R
│   └── report.Rmd
└── output
    ├── histogram_energy_diagnostic.png
    ├── barplot_consumption_pcs.png
    ├── correlation_matrix.png
    └── report.pdf</code></pre>
</section>
<section id="documenter-son-projet" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2><span class="emoji" data-emoji="four">4️⃣</span> Documenter son projet</h2>
<ul>
<li class="fragment"><p>Le fichier <code>README.md</code>, situé à la racine du projet, est à la fois la <strong>carte d’identité</strong> et la <strong>vitrine du projet</strong></p></li>
<li class="fragment"><p>Idéalement, il contient :</p>
<ul>
<li class="fragment">Une <span class="orange"><strong>présentation</strong></span> du contexte et des objectifs</li>
<li class="fragment">Une description de son <span class="orange"><strong>fonctionnement</strong></span></li>
<li class="fragment">Un guide de <span class="orange"><strong>contribution</strong></span> (<em>open-source</em>)</li>
</ul></li>
<li class="fragment"><p>Quelques modèles de <code>README.md</code> complets :</p>
<ul>
<li class="fragment"><a href="https://github.com/InseeFrLab/utilitR/blob/master/README.md">utilitR</a></li>
<li class="fragment"><a href="https://github.com/InseeFrLab/DoReMIFaSol">DoReMIFaSol</a></li>
</ul></li>
</ul>
</section>
<section id="faire-de-son-projet-un-package" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2><span class="emoji" data-emoji="five">5️⃣</span> Faire de son projet un <em>package</em></h2>
<ul>
<li class="fragment">Un <em>package</em> est la forme maximale de <span class="orange"><strong>modularité</strong></span>
<ul>
<li class="fragment">Contient des <span class="blue2"><strong>fonctions</strong></span> rangées dans des <span class="blue2"><strong>modules</strong></span></li>
<li class="fragment">Contient également de la <span class="blue2"><strong>documentation</strong></span>, des <span class="blue2"><strong>tests</strong></span>, des (méta-)données…</li>
</ul></li>
<li class="fragment"><span class="orange"><strong>Avantages</strong></span>
<ul>
<li class="fragment">Idéal pour favoriser la <span class="blue2"><strong>réutilisation</strong></span> du code</li>
<li class="fragment">Des <span class="blue2"><strong>outils</strong></span> de développement : <code>devtools</code> et <code>usethis</code></li>
</ul></li>
<li class="fragment"><span class="orange"><strong>Inconvénients</strong></span>
<ul>
<li class="fragment">Coût de <span class="blue2"><strong>maintenance</strong></span> élevé</li>
</ul></li>
</ul>
</section>
<section id="ressources-supplémentaires-2" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Ressources supplémentaires</h2>
<p><br></p>
<ul>
<li class="fragment">La documentation utilitR sur les <a href="https://book.utilitr.org/03_Fiches_thematiques/Fiche_rprojects">projets RStudio</a> et les <a href="https://book.utilitr.org/01_R_Insee/Fiche_installer_packages">packages R</a></li>
<li class="fragment">La <a href="https://r-pkgs.org/whole-game.html">bible des packages R</a></li>
</ul>
</section>
<section id="application-2-1" class="slide level2 smaller" data-background-image="background.svg" data-background-size="contain">
<h2>Application 2</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Partie 1 : modularisation du projet</strong></p>
</div>
<div class="callout-content">
<ol type="1">
<li>Déplacer toutes les fonctions dans un fichier <code>R/functions.R</code>.</li>
<li>Donner à la fonction <code>fonction_de_stat_agregee</code> un nom plus pertinent et des noms d’arguments plus transparents.
<ul>
<li>Documenter la fonction <code>fonction_de_stat_agregee</code> selon le standard <code>roxygen</code>. Vous pouvez vous aider d’une IA assistante comme <code>ChatGPT</code>, <code>Claude</code> ou <code>Copilot</code>, rien n’est sensible dans ce code (d’ailleurs rien de sensible ne doit être dans du code !).</li>
<li>Utiliser les exemples d’utilisation de <code>fonction_de_stat_agregee</code> dans cette documentation.</li>
</ul></li>
<li>Dans <code>script.R</code>, appeler en début de chaîne ces fonctions avec <code>source("R/functions.R", encoding = "UTF-8")</code>.</li>
<li>Tester le bon fonctionnement de <code>script.R</code>.</li>
<li>Si votre chaîne écrit des <em>outputs</em> ou utilise des <em>inputs</em> (par exemple des données), restructurer l’aborescence du projet pour le rendre plus lisible et adaptez votre code en fonction.</li>
<li>Renommer (voire déplacer) les scripts <code>get_data.R</code> et <code>script.R</code> pour rendre plus intelligible la chaîne de production.</li>
<li>Mettre à jour le <code>.gitignore</code> puis <em>commit</em>/<em>push</em>.</li>
</ol>
</div>
</div>
</div>
</section>
<section id="application-2-2" class="slide level2 smaller" data-background-image="background.svg" data-background-size="contain">
<h2>Application 2</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Partie 2 : création d’un <em>package</em> (FACULTATIF)</strong></p>
</div>
<div class="callout-content">
<ol type="1">
<li>Fermer le Rproj en cours (“Close Project” en haut à droite).</li>
<li>Initialiser un <em>package</em> avec la fonction <code>usethis::create_package()</code> (par défaut dans le <em>working directory</em>)</li>
<li>Placer dans le dossier <code>R</code> du <em>package</em> un module <code>stat.R</code> et y copier la fonction de statistique agrégée</li>
<li>Remplir le fichier <code>DESCRIPTION</code>. En particulier, spécifier les dépendances nécessaires (<code>Imports</code>) et facultatives (<code>Suggests</code>)</li>
<li>Construire la documentation du <em>package</em> avec la fonction <code>devtools::document()</code>. Où est-elle stockée et sous quel format ?</li>
<li>Charger le package avec la fonction <code>devtools::load_all()</code> et vérifier que la fonction marche correctement</li>
<li>Vérifier que la documentation de notre fonction est accessible avec <code>?ma_fonction</code></li>
<li>(Facultatif) Initialiser un nouveau projet sur <code>GitHub</code> est y mettre le code du <em>package</em>. Vérifier que le <em>package</em> peut être installé en local avec la fonction <code>devtools::install_github()</code>.</li>
</ol>
</div>
</div>
</div>
</section>
<section id="checkpoint-2" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Checkpoint</h2>
<div class="callout callout-caution callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Checkpoint</strong></p>
</div>
<div class="callout-content">
<ul>
<li>Le script <a href="https://raw.githubusercontent.com/InseeFrLab/formation-bonnes-pratiques-git-R/refs/heads/main/R/checkpoints/application2/script.R"><code>script.R</code></a></li>
<li>Le script <a href="https://raw.githubusercontent.com/InseeFrLab/formation-bonnes-pratiques-git-R/refs/heads/main/R/checkpoints/application2/functions.R"><code>R/functions.R</code></a></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="checkpoint.jpg" class="quarto-figure quarto-figure-center" style="width:40.0%"></p>
</figure>
</div>
</div>
</div>
</div>
</section></section>
<section>
<section id="iii--formats-de-données" class="title-slide slide level1 center" data-background-image="background.svg" data-background-size="contain">
<h1>III- Formats de données</h1>

</section>
<section id="enjeux-2" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Enjeux</h2>
<ul>
<li class="fragment">Le choix d’un format de données répond à un <span class="orange"><strong>arbitrage</strong></span> entre plusieurs critères :
<ul>
<li class="fragment"><span class="blue2"><strong>Public cible</strong></span></li>
<li class="fragment"><span class="blue2"><strong>Finalité</strong></span> (traitement, analyse, diffusion)</li>
<li class="fragment"><span class="blue2"><strong>Volumétrie</strong></span></li>
<li class="fragment"><span class="blue2"><strong>Interopérabilité</strong></span></li>
</ul></li>
</ul>
</section>
<section id="formats-traditionnels" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Formats traditionnels</h2>
<ul>
<li class="fragment">Formats de données adhérents à un langage (<span class="orange"><strong>sas7bdat</strong></span>, <span class="orange"><strong>RDS</strong></span>, <span class="orange"><strong>fst</strong></span>, etc.)
<ul>
<li class="fragment"><span class="blue2"><strong>Non-interopérables</strong></span> -&gt; à éviter !</li>
</ul></li>
<li class="fragment">Le format <span class="orange"><strong>CSV</strong></span>
<ul>
<li class="fragment"><span class="blue2"><strong>Interopérable</strong></span> et <span class="blue2"><strong>simple</strong></span> d’utilisation</li>
<li class="fragment">Pas de gestion des <span class="blue2"><strong>méta-données</strong></span></li>
<li class="fragment">Peu adapté aux <span class="blue2"><strong>données volumineuses</strong></span></li>
</ul></li>
</ul>
</section>
<section id="limites-du-csv" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Limites du <code>CSV</code></h2>
<ul>
<li class="fragment">Des <span class="orange"><strong>performances limitées</strong></span>
<ul>
<li class="fragment"><span class="blue2"><strong>Stockage</strong></span> : non-compressé -&gt; <span class="blue2"><strong>espace disque élevé</strong></span></li>
<li class="fragment"><span class="blue2"><strong>Lecture</strong></span> : “orienté-ligne” -&gt; <span class="blue2"><strong>performances faibles</strong></span></li>
</ul></li>
</ul>
<div class="fragment">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="img/row-column.png" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div>
</section>
<section id="le-format-parquet" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Le format <code>Parquet</code></h2>
<ul>
<li class="fragment"><span class="orange"><strong>Stockage</strong></span> :
<ul>
<li class="fragment"><span class="blue2"><strong>Compression</strong></span> : entre 5 et 20 fois plus léger qu’un CSV</li>
</ul></li>
</ul>
<div class="fragment">
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Exemple: Recensement de la Population</strong></p>
</div>
<div class="callout-content">
<ul>
<li><a href="https://www.insee.fr/fr/statistiques/8268848?sommaire=8205966">Ficher détail</a> : 20 millions de lignes, 92 variables
<ul>
<li>CSV: &gt; 4Go</li>
<li>Parquet: &lt; 500Mo</li>
</ul></li>
</ul>
</div>
</div>
</div>
</div>
</section>
<section id="le-format-parquet-1" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Le format <code>Parquet</code></h2>
<ul>
<li class="fragment"><span class="orange"><strong>Lecture</strong></span> :
<ul>
<li class="fragment">Jusqu’à 34x plus rapide qu’un CSV</li>
</ul></li>
<li class="fragment"><span class="orange"><strong>“Orienté colonne”</strong></span>
<ul>
<li class="fragment">Optimisé pour les <span class="blue2"><strong>traitements analytiques</strong></span></li>
<li class="fragment">Limite la quantité de données à mettre en mémoire</li>
</ul></li>
</ul>
<div class="fragment">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="img/parquet-read-columns.png" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div>
</section>
<section id="le-format-parquet-2" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Le format <code>Parquet</code></h2>
<ul>
<li class="fragment"><span class="orange"><strong>Partitionner</strong></span> les données pour <span class="blue2"><strong>optimiser la lecture</strong></span></li>
</ul>
<div class="fragment">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="img/partitions.png" class="quarto-figure quarto-figure-center" height="250"></p>
</figure>
</div>
<div class="callout callout-warning callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>L’art de bien partitionner</strong></p>
</div>
<div class="callout-content">
<ul>
<li><p>Partitionner par une/des <span class="blue2"><strong>variable(s) d’intérêt</strong></span></p></li>
<li><p><span class="blue2"><strong>Eviter</strong></span> de créer de <span class="blue2"><strong>nombreux petits (&lt; 128Mo) fichiers</strong></span></p></li>
</ul>
</div>
</div>
</div>
</div>
</section>
<section id="le-format-parquet-3" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Le format <code>Parquet</code></h2>
<ul>
<li class="fragment"><p>Gestion native des <span class="orange"><strong>méta-données</strong></span></p>
<ul>
<li class="fragment">Définition automatique d’un <span class="blue2"><strong>schéma</strong></span> (noms, types)</li>
<li class="fragment">Mise à disposition plus <span class="blue2"><strong>robuste</strong></span></li>
</ul></li>
<li class="fragment"><p><span class="orange"><strong>Interopérable</strong></span></p></li>
<li class="fragment"><p><span class="orange"><strong>Open-source</strong></span></p></li>
</ul>
</section>
<section id="le-format-parquet-4" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Le format <code>Parquet</code></h2>
<ul>
<li class="fragment">Deux <em>frameworks</em> de référence : <a href="https://book.utilitr.org/03_Fiches_thematiques/Fiche_arrow.html">Arrow</a> et <a href="https://book.utilitr.org/03_Fiches_thematiques/Fiche_duckdb.html">DuckDB</a>
<ul>
<li class="fragment">Orientation <span class="blue2"><strong>fichier</strong></span> (<code>Arrow</code>) VS orientation <span class="blue2"><strong>BDD</strong></span> (<code>DuckDB</code>)</li>
<li class="fragment">Très bonne <span class="blue2"><strong>intégration</strong></span> avec le <code>tidyverse</code></li>
</ul></li>
<li class="fragment"><span class="orange"><strong>Traitement en-mémoire optimisé</strong></span>
<ul>
<li class="fragment"><span class="blue2"><strong>Orientés-colonne</strong></span></li>
<li class="fragment"><span class="blue2"><strong><em>Lazy evaluation</em></strong></span></li>
</ul></li>
</ul>
<div class="fragment">
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Exemple d’une requête <em>lazy</em></strong></p>
</div>
<div class="callout-content">
<div class="sourceCode" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a></a>n_logements_depcom <span class="ot">&lt;-</span> achille <span class="sc">|&gt;</span> </span>
<span id="cb7-2"><a></a>  <span class="fu">filter</span>(dep <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"01"</span>, <span class="st">"02"</span>, <span class="st">"03"</span>)) <span class="sc">|&gt;</span>  <span class="co"># Récupère seulement les données nécessaires</span></span>
<span id="cb7-3"><a></a>  <span class="fu">select</span>(idlogement, depcom) <span class="sc">|&gt;</span>  <span class="co"># Récupère seulement les colonnes nécessaires</span></span>
<span id="cb7-4"><a></a>  <span class="fu">group_by</span>(depcom) <span class="sc">|&gt;</span></span>
<span id="cb7-5"><a></a>  <span class="fu">summarise</span>(<span class="at">n_logements =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span>  </span>
<span id="cb7-6"><a></a>  <span class="fu">collect</span>()  <span class="co"># Les calculs ne sont effectués qu'à cette étape !</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="le-format-parquet-5" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Le format <code>Parquet</code></h2>
<ul>
<li class="fragment"><code>Parquet</code> gagne sur tous les tableaux</li>
</ul>
<div class="fragment">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="img/tableau-perf-parquet.png" class="quarto-figure quarto-figure-center" height="500"></p>
</figure>
</div>
</div>
</section>
<section id="application-3-1" class="slide level2 smaller" data-background-image="background.svg" data-background-size="contain">
<h2>Application 3</h2>
<div class="panel-tabset">
<ul id="tabset-4" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-4-1"><i class="fa-brands fa-github" aria-label="github"></i></a></li><li><a href="#tabset-4-2"><i class="fa-brands fa-gitlab" aria-label="gitlab"></i> insee</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1">
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Partie 0 : Préparation</strong></p>
</div>
<div class="callout-content">
<ul>
<li>Remplacer le contenu du script <code>get_data.R</code> en copiant-collant le contenu de <a href="https://raw.githubusercontent.com/InseeFrLab/formation-bonnes-pratiques-git-R/refs/heads/main/R/checkpoints/application3/get_data.R">ce fichier</a>. Exécuter ce script, il importe les fichiers nécessaires pour cette application.</li>
</ul>
</div>
</div>
</div>
</div>
<div id="tabset-4-2">
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Partie 0 : Préparation</strong></p>
</div>
<div class="callout-content">
<ul>
<li>Remplacer le contenu du script <code>get_data.R</code> en copiant-collant le contenu de <a href="https://raw.githubusercontent.com/InseeFrLab/formation-bonnes-pratiques-git-R/refs/heads/main/R/checkpoints/application3/get_data_ls3.R">ce fichier</a>. Exécuter ce script, il importe les fichiers nécessaires pour cette application.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="application-3-2" class="slide level2 smaller" data-background-image="background.svg" data-background-size="contain">
<h2>Application 3</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Partie 1 : Du <code>CSV</code> au <code>Parquet</code></strong></p>
</div>
<div class="callout-content">
<p>Tout au long de cette application, nous allons voir comment utiliser le format <code>Parquet</code> de manière la plus efficiente. Afin de comparer les différents formats et méthodes d’utilisation, nous allons <strong>comparer le temps d’exécution et l’usage mémoire d’une requête standard</strong>. Commençons par comparer les formats <code>CSV</code> et <code>Parquet</code>.</p>
<ul>
<li>Créer un script <code>benchmark_parquet.R</code> afin de réaliser les différentes comparaisons de performance de l’application</li>
<li>Pour effectuer les comparaisons de performance, on va utiliser la fonction <a href="https://bench.r-lib.org/#benchmark">bench::mark</a>. Analyser la documentation pour comprendre ce que la fonction attend en entrée.</li>
<li>La requête suivante permet de calculer les données pour construire une pyramide des âges sur un département donné, à partir du fichier <code>CSV</code> du recensement. Encapsuler la requête dans une fonction <code>req_csv</code> (sans argument).</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a></a>res <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">"data/RPindividus_24.csv"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb8-2"><a></a>    <span class="fu">filter</span>(DEPT <span class="sc">==</span> <span class="st">"36"</span>) <span class="sc">|&gt;</span></span>
<span id="cb8-3"><a></a>    <span class="fu">group_by</span>(AGED, DEPT) <span class="sc">|&gt;</span></span>
<span id="cb8-4"><a></a>    <span class="fu">summarise</span>(<span class="at">n_indiv =</span> <span class="fu">sum</span>(IPONDI))</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Sur le même modèle, construire une fonction <code>req_read_parquet</code> basée cette fois sur le fichier <code>data/RPindividus_24.parquet</code> chargé avec la fonction <a href="https://arrow.apache.org/docs/r/reference/read_parquet.html">read_parquet</a> d’<code>Arrow</code></li>
<li>Comparer les performances (temps d’exécution et allocation mémoire) de ces deux méthodes grâce à la fonction <a href="https://bench.r-lib.org/#benchmark">bench::mark</a>, à laquelle on passera les paramètres <code>iterations = 1</code> (comparaison à partir d’une seule itération) et <code>check = FALSE</code> (autorise les outputs des deux fonctions à être différents).</li>
</ul>
</div>
</div>
</div>
<p><em>❓️ Quelle semble être la limite de la fonction <code>read_parquet</code> ?</em></p>
</section>
<section id="application-3-3" class="slide level2 smaller" data-background-image="background.svg" data-background-size="contain">
<h2>Application 3</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Partie 2 : Exploiter la <em>lazy evaluation</em> et les optimisations d’<code>Arrow</code></strong></p>
</div>
<div class="callout-content">
<p>La partie précédente a montré un <strong>gain de temps considérable</strong> du passage de <code>CSV</code> à <code>Parquet</code>. Néanmoins, l’<strong>utilisation mémoire était encore très élevée</strong> alors qu’on utilise de fait qu’une infime partie du fichier. Dans cette partie, on va voir comment utiliser la <strong><em>lazy evaluation</em></strong> et les <strong>optimisations du plan d’exécution</strong> effectuées par <code>Arrow</code> pour exploiter pleinement la puissance du format <code>Parquet</code>.</p>
<ul>
<li>Utiliser la fonction <a href="https://arrow.apache.org/docs/r/reference/open_dataset.html">arrow::open_dataset</a> pour ouvrir le fichier <code>data/RPindividus_24.parquet</code>. Regarder la classe de l’objet obtenu.</li>
<li>Afficher les 5 premières lignes de la table avec la fonction <code>head()</code>. Observer l’objet obtenu (sortie en console, classe).</li>
<li>Ajouter une étape <code>collect()</code> à la fin de cette chaîne. Comprenez-vous la différence ?</li>
<li>Construire une fonction <code>req_open_dataset</code> sur le modèle de celles de la partie précédente, qui importe cette fois les données avec la fonction <a href="https://arrow.apache.org/docs/r/reference/open_dataset.html">arrow::open_dataset</a></li>
<li>Comparer les performances (temps d’exécution et allocation mémoire) des trois méthodes (<code>CSV</code>, <code>read_parquet</code> et <code>open_dataset</code>) grâce à la fonction <a href="https://bench.r-lib.org/#benchmark">bench::mark</a></li>
</ul>
</div>
</div>
</div>
<p><em>❓️ Quelle méthode retenir pour lire un <code>Parquet</code> avec <code>Arrow</code> ?</em></p>
</section>
<section id="application-3-4" class="slide level2 smaller" data-background-image="background.svg" data-background-size="contain">
<h2>Application 3</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Partie 3 : Le <code>Parquet</code> partitionné</strong></p>
</div>
<div class="callout-content">
<p>La <em>lazy evaluation</em> et les optimisations d’<code>Arrow</code> apportent des gain de performance considérables. Mais on peut encore faire mieux ! Lorsqu’on sait qu’on va être amené à <strong>filter régulièrement les données selon une variable d’intérêt</strong>, on a tout intérêt à <strong>partitionner</strong> le fichier <code>Parquet</code> selon cette variable.</p>
<ul>
<li>Parcourir la documentation de la fonction <a href="https://arrow.apache.org/docs/r/reference/write_dataset.html">arrow::write_dataset</a> pour comprendre comment spécifier la clé de partitionnement d’un fichier <code>Parquet</code>. Plusieurs méthodes sont possibles !</li>
<li>Importer la table individus complète du recensement <code>data/RPindividus.parquet</code> avec la fonction <a href="https://arrow.apache.org/docs/r/reference/open_dataset.html">arrow::open_dataset</a> et l’exporter en une table <code>data/RPindividus_partitionne.parquet</code> partitionnée par la région (<code>REGION</code>) et le département (<code>DEPT</code>)</li>
<li>Observer l’arborescence de fichiers de la table exportée</li>
<li>Modifier la fonction <code>req_open_dataset</code> de la partie précédente pour partir de la table complète (non-partitionnée) <code>data/RPindividus.parquet</code> au lieu de l’échantillon</li>
<li>Construire une fonction <code>req_open_dataset_partitionne</code> sur le modèle de <code>req_open_dataset</code>, qui importe cette fois les données partitionnées <code>data/RPindividus_partitionne.parquet</code>. Ne pas oublier de spécifier le paramètre <code>hive_style = TRUE</code>.</li>
<li>Comparer les performances (temps d’exécution et allocation mémoire) des deux méthodes grâce à la fonction <a href="https://bench.r-lib.org/#benchmark">bench::mark</a></li>
</ul>
</div>
</div>
</div>
<p><em>❓️ Dans le cadre d’une mise à disposition de données en <code>Parquet</code>, comment bien choisir la/les clé(s) de partitionnement ? Quelle est la limite à garder en tête ?</em></p>
</section>
<section id="application-3-5" class="slide level2 smaller" data-background-image="background.svg" data-background-size="contain">
<h2>Application 3</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Partie 4 : mise à jour de la chaîne de production</strong></p>
</div>
<div class="callout-content">
<p>Convaincus par ce comparatif, nous allons maintenant mettre à jour le format des données utilisées pour notre chaîne de production.</p>
<ul>
<li>Modifier le script <code>script.R</code> pour importer les données d’entrée de votre chaîne à partir de la table <code>Parquet</code> partitionnée <code>data/RPindividus_partitionne.parquet</code></li>
<li>Vérifier que le script complet s’exécute correctement et l’adapter si ce n’est pas le cas</li>
</ul>
</div>
</div>
</div>
<p><em>❓️ Cette mise à jour des données utilisées en source de la chaîne de production vous a-t-elle paru compliquée ? Pourquoi ?</em></p>
</section>
<section id="checkpoint-4" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Checkpoint</h2>
<div class="callout callout-caution callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Checkpoint</strong></p>
</div>
<div class="callout-content">
<ul>
<li>Le script <a href="https://raw.githubusercontent.com/InseeFrLab/formation-bonnes-pratiques-git-R/refs/heads/main/R/checkpoints/application3/benchmark_parquet.R"><code>benchmark_parquet.R</code></a></li>
<li>Le script <a href="https://raw.githubusercontent.com/InseeFrLab/formation-bonnes-pratiques-git-R/refs/heads/main/R/checkpoints/application3/script.R"><code>script.R</code></a></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="checkpoint.jpg" class="quarto-figure quarto-figure-center" style="width:40.0%"></p>
</figure>
</div>
</div>
</div>
</div>
</section></section>
<section>
<section id="iv--environnements-reproductibles" class="title-slide slide level1 center" data-background-image="background.svg" data-background-size="contain">
<h1>IV- Environnements reproductibles</h1>

</section>
<section id="enjeux-3" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Enjeux</h2>
<ul>
<li class="fragment"><p>Imaginons la situation suivante :</p>
<ul>
<li class="fragment">J’installe une version de <code>R</code> sur mon poste</li>
<li class="fragment">Je développe un projet en installant les <em>packages</em> nécessaires</li>
<li class="fragment">Une fois terminé, je passe au projet suivant, et ainsi de suite.</li>
</ul></li>
<li class="fragment"><p>Quels <span class="orange"><strong>problèmes</strong></span> puis-je rencontrer au fil des projets ?</p></li>
<li class="fragment"><p>Est-il facile de <span class="orange"><strong>partager</strong></span> un de mes projets ?</p></li>
</ul>
</section>
<section id="enjeux-4" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Enjeux</h2>
<ul>
<li class="fragment"><p><span class="orange"><strong>Version de</strong></span> <span class="blue2"><strong>R</strong></span> <span class="orange"><strong>fixe</strong></span>, celle de l’installation système</p></li>
<li class="fragment"><p><span class="orange"><strong>Conflits de version</strong></span> : différents projets peuvent requérir différentes versions d’un même <em>package</em>.</p></li>
<li class="fragment"><p><span class="orange"><strong>Reproductibilité limitée</strong></span> : difficile de dire quel projet nécessite quel <em>package</em>.</p></li>
<li class="fragment"><p><span class="orange"><strong>Portabilité limitée</strong></span> : difficile de préciser dans un fichier les dépendances spécifiques à un projet.</p></li>
</ul>
</section>
<section id="des-environnements-reproductibles-avec-renv" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Des environnements reproductibles avec <code>renv</code></h2>
<ul>
<li class="fragment"><p><code>renv</code> permet de créer des <strong>env</strong>ironnements <strong>r</strong>eproductibles</p></li>
<li class="fragment"><p><span class="orange"><strong>Isolation</strong></span> : chaque projet dispose de sa propre librairie de packages</p></li>
<li class="fragment"><p><span class="orange"><strong>Reproductibilité</strong></span> : <code>renv</code> enregistre les versions exactes des <em>packages</em> nécessaires au projet</p></li>
<li class="fragment"><p><span class="orange"><strong>Portabilité</strong></span>: un tiers peut exécuter le projet avec les mêmes spécifications</p></li>
</ul>
</section>
<section id="utilisation-de-renv" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Utilisation de <code>renv</code></h2>
<ol type="1">
<li class="fragment"><p><span class="orange"><strong>Initialisation</strong></span> (<code>init</code>) de l’environnement local du projet</p></li>
<li class="fragment"><p><span class="orange"><strong>Développement</strong></span> du projet</p></li>
<li class="fragment"><p><span class="orange"><strong>Enregistrement</strong></span> (<code>snapshot</code>) des versions des <em>packages</em> installés</p></li>
<li class="fragment"><p><span class="orange"><strong>Restauration</strong></span> (<code>restore</code>) d’un environnement</p></li>
</ol>
</section>
<section id="initialisation-de-lenvironnement" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2><span class="emoji" data-emoji="one">1️⃣</span> Initialisation de l’environnement</h2>
<ul>
<li class="fragment"><code>renv::init()</code> dans un projet RStudio crée :
<ul>
<li class="fragment">Un dossier <code>renv</code> et le fichier <code>.Rprofile</code> : activation automatique de l’environnement</li>
<li class="fragment">Le fichier <code>renv.lock</code> : versions des <em>packages</em> installés</li>
</ul></li>
</ul>
<div class="fragment">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="img/renv_init.png" class="quarto-figure quarto-figure-center" height="400"></p>
</figure>
</div>
</div>
</section>
<section id="développement-du-projet" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2><span class="emoji" data-emoji="two">2️⃣</span> Développement du projet</h2>
<ul>
<li class="fragment">Une fois l’environnement initialisé, on développe le projet de manière habituelle :
<ul>
<li class="fragment">Installations/suppressions/mises à jour de packages</li>
<li class="fragment">Ecriture de scripts</li>
</ul></li>
<li class="fragment"><code>renv::status()</code> : indique les <em>packages</em> installés/supprimés par rapport au fichier <code>renv.lock</code></li>
</ul>
</section>
<section id="enregistrement-de-lenvironnement" class="slide level2 smaller" data-background-image="background.svg" data-background-size="contain">
<h2><span class="emoji" data-emoji="three">3️⃣</span> Enregistrement de l’environnement</h2>
<ul>
<li class="fragment"><p><code>renv::snapshot()</code> : enregistre les versions des <em>packages</em> installés dans le fichier <code>renv.lock</code></p></li>
<li class="fragment"><p>Ne pas oublier de committer le fichier <code>renv.lock</code>!</p></li>
</ul>
<div class="fragment">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="img/renv_snapshot.png" class="quarto-figure quarto-figure-center" height="350"></p>
</figure>
</div>
</div>
</section>
<section id="restauration-de-lenvironnement" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2><span class="emoji" data-emoji="four">4️⃣</span> Restauration de l’environnement</h2>
<ul>
<li class="fragment"><p><code>renv::restore()</code> : installe/désinstalle les <em>packages</em> nécessaires pour arriver à l’état spécifié dans le fichier <code>renv.lock</code></p></li>
<li class="fragment"><p><span class="orange"><strong>Portabilité</strong></span> : un tiers peut recréer un environnement avec les mêmes spécifications</p></li>
</ul>
</section>
<section id="application-4-2" class="slide level2 smaller" data-background-image="background.svg" data-background-size="contain">
<h2>Application 4</h2>
<div class="panel-tabset">
<ul id="tabset-5" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-5-1"><i class="fa-brands fa-github" aria-label="github"></i></a></li><li><a href="#tabset-5-2"><i class="fa-brands fa-gitlab" aria-label="gitlab"></i> insee</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1">
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Partie 0 : Préparation</strong></p>
</div>
<div class="callout-content">
<ul>
<li>Remplacer le contenu du script <code>get_data.R</code> en copiant-collant le contenu de <a href="https://raw.githubusercontent.com/InseeFrLab/formation-bonnes-pratiques-git-R/refs/heads/main/R/checkpoints/application4/get_data.R">ce fichier</a>. Exécuter ce script, il importe les fichiers nécessaires pour cette application.</li>
</ul>
</div>
</div>
</div>
</div>
<div id="tabset-5-2">
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Partie 0 : Préparation</strong></p>
</div>
<div class="callout-content">
<ul>
<li>Remplacer le contenu du script <code>get_data.R</code> en copiant-collant le contenu de <a href="https://raw.githubusercontent.com/InseeFrLab/formation-bonnes-pratiques-git-R/refs/heads/main/R/checkpoints/application4/get_data_ls3.R">ce fichier</a>. Exécuter ce script, il importe les fichiers nécessaires pour cette application.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="application-4-3" class="slide level2 smaller" data-background-image="background.svg" data-background-size="contain">
<h2>Application 4</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Partie 1 : Initialisation de l’environnement virtuel</strong></p>
</div>
<div class="callout-content">
<ul>
<li>Vérifier tout d’abord que vous arrivez à charger le package <code>sf</code> avec la fonction <code>library()</code>.</li>
<li>Initialiser l’environnement virtuel avec la commande <code>renv::init()</code>, <strong>lire le message</strong> et accepter.</li>
<li>Observer les nouveaux fichiers et dossiers qui sont apparus dans le projet. En particulier, comment <code>renv</code> a-t-il choisi les packages à ajouter au fichier <code>renv.lock</code> ?</li>
<li>Essayer de charger à nouveau le package <code>sf</code>. Comprenez-vous pourquoi celui-ci n’est plus disponible ?</li>
</ul>
</div>
</div>
</div>
</section>
<section id="application-4-4" class="slide level2 smaller" data-background-image="background.svg" data-background-size="contain">
<h2>Application 4</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Partie 2 : Mise à jour du fichier <code>renv.lock</code></strong></p>
</div>
<div class="callout-content">
<ul>
<li>Dans la partie sur les statistiques descriptives du script <code>script.R</code>, ajouter ce <a href="https://raw.githubusercontent.com/InseeFrLab/formation-bonnes-pratiques-git-R/refs/heads/main/R/checkpoints/application4/ajout_script.R">morceau de code</a>, qui produit une carte à l’aide du package <code>sf</code></li>
<li>Dans la console, faire <code>renv::status()</code> et observer le message</li>
<li>Installer le package <code>sf</code></li>
<li>Effectuer à nouveau <code>renv::status()</code> et observer le message</li>
<li>Intégrer les nouveaux packages au fichier <code>renv.lock</code> avec la commande <code>renv::snapshot()</code></li>
<li>Effectuer à nouveau <code>renv::status()</code> et observer le message</li>
<li>Faire un <em>commit</em> / <em>push</em> des différents fichiers qui ont été modifiés</li>
</ul>
</div>
</div>
</div>
</section>
<section id="application-4-5" class="slide level2 smaller" data-background-image="background.svg" data-background-size="contain">
<h2>Application 4</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Partie 3 : Test de portabilité</strong></p>
</div>
<div class="callout-content">
<ul>
<li>Ouvrir un nouveau projet <code>RStudio</code> et cloner à nouveau votre dépôt (sous un nom différent)</li>
<li>Exécuter <code>renv::restore()</code> pour installer les packages nécessaires à l’exécution du projet</li>
<li>Vérifier que le <code>script.R</code> s’exécute correctement dans ce nouveau projet</li>
<li>(optionnel) Si vous n’êtes toujours pas convaincu de la <strong>portabilité</strong> de la solution, ouvrir un nouveau service <code>RStudio</code> et refaire les étapes précédentes</li>
</ul>
</div>
</div>
</div>
</section>
<section id="checkpoint-6" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Checkpoint</h2>
<div class="callout callout-caution callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Checkpoint</strong></p>
</div>
<div class="callout-content">
<ul>
<li>Le script <a href="https://raw.githubusercontent.com/InseeFrLab/formation-bonnes-pratiques-git-R/refs/heads/main/R/checkpoints/application4/script.R"><code>script.R</code></a></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="checkpoint.jpg" class="quarto-figure quarto-figure-center" style="width:40.0%"></p>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="vers-une-reproductibilité-optimale" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Vers une reproductibilité optimale</h2>
<ul>
<li class="fragment"><p><span class="orange"><strong>Limites</strong></span> des environnements virtuels :</p>
<ul>
<li class="fragment">Les <span class="blue2"><strong>librairies système</strong></span> ne sont pas gérées</li>
<li class="fragment">Lourdeur de la phase d’installation à chaque changement d’environnement</li>
<li class="fragment">Peu adaptés à un environnement de production</li>
</ul></li>
<li class="fragment"><p>La <span class="orange"><strong>conteneurisation</strong></span> (ex : <code>Docker</code>) apporte la solution</p></li>
<li class="fragment"><p><span class="orange"><strong>Intuition</strong></span> : au lieu de distribuer la recette pour recréer l’environnement, <span class="blue2"><strong>distribuer directement une “machine” qui contient <em>tout</em> l’environnement nécessaire au projet</strong></span></p></li>
</ul>
</section>
<section id="ressources-supplémentaires-3" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Ressources supplémentaires</h2>
<ul>
<li class="fragment"><p>La <a href="https://rstudio.github.io/renv/articles/renv.html">documentation officielle de <code>renv</code></a></p></li>
<li class="fragment"><p>La <a href="https://book.utilitr.org/03_Fiches_thematiques/Fiche_gerer_dependances">fiche utilitR sur la gestion des dépendances</a></p></li>
</ul>
</section></section>
<section>
<section id="v--r-en-production" class="title-slide slide level1 center" data-background-image="background.svg" data-background-size="contain">
<h1>V- <code>R</code> en production</h1>

</section>
<section id="de-quoi-parle-t-on" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>De quoi parle-t-on ?</h2>
<ul>
<li class="fragment"><p><span class="orange"><strong>Production statistique</strong></span> : chiffres, données, analyses produits par l’Insee / les SSM</p></li>
<li class="fragment"><p><span class="orange"><strong>Production informatique</strong></span> : processus maintenus par la <span class="blue2"><strong>DSI</strong></span> sur des <span class="blue2"><strong>infrastructures avec “garantie de service”</strong></span></p></li>
<li class="fragment"><p><span class="orange"><strong>Self de production</strong></span> : processus maintenus par le <span class="blue2"><strong>métier</strong></span> sur une <span class="blue2"><strong>infrastructure “self”</strong></span></p></li>
<li class="fragment"><p><span class="orange"><strong>Code de production</strong></span> : code respectant des <span class="blue2"><strong>standards de qualité</strong></span> qui le rendent <span class="blue2"><strong>efficace</strong></span> et <span class="blue2"><strong>maintenable</strong></span></p></li>
</ul>
</section>
<section id="r-un-langage-de-production" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2><code>R</code> : un langage de production ?</h2>
<ul>
<li class="fragment"><code>R</code> a émergé dans la <span class="orange"><strong>communauté statistique</strong></span>
<ul>
<li class="fragment">Outils d’<span class="blue2"><strong>analyse interactive</strong></span> très développés</li>
<li class="fragment">Outils de <span class="blue2"><strong>développement</strong></span> limités</li>
</ul></li>
<li class="fragment">L’<span class="orange"><strong>éco-système tidyverse</strong></span> s’oriente vers des outils <span class="blue2"><strong><em>production-ready</em></strong></span></li>
</ul>
<div class="fragment">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="img/tidyverse.png" class="quarto-figure quarto-figure-center" height="250"></p>
</figure>
</div>
</div>
</section>
<section id="les-trois-commandements-dhadley" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Les trois commandements d’Hadley</h2>
<ul>
<li class="fragment">Le <span class="orange"><strong>code de production</strong></span> a trois caractéristiques
<ul>
<li class="fragment"><span class="blue2"><strong>“Not just me”</strong></span></li>
<li class="fragment"><span class="blue2"><strong>“Not just once”</strong></span></li>
<li class="fragment"><span class="blue2"><strong>“Not just my computer”</strong></span></li>
</ul></li>
</ul>
<div class="fragment">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="img/hadley.jpg" class="quarto-figure quarto-figure-center" height="250"></p>
</figure>
</div>
</div>
</section>
<section id="les-trois-commandements-dhadley-1" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Les trois commandements d’Hadley</h2>
<ul>
<li>Le <span class="orange"><strong>code de production</strong></span> a trois caractéristiques
<ul>
<li><span class="blue2"><strong>“Not just me”</strong></span></li>
<li><span style="color: lightgrey;"><strong>“Not just once”</strong></span></li>
<li><span style="color: lightgrey;"><strong>“Not just my computer”</strong></span></li>
</ul></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="img/hadley.jpg" class="quarto-figure quarto-figure-center" height="250"></p>
</figure>
</div>
</section>
<section id="not-just-me" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>“Not just me”</h2>
<ul>
<li class="fragment"><p>Penser son projet en termes de <span class="orange"><strong>maintenabilité</strong></span></p></li>
<li class="fragment"><p>Adopter les <span class="orange"><strong>standards communautaires</strong></span></p>
<ul>
<li class="fragment"><span class="blue2"><strong>Git</strong></span> pour la <span class="blue2"><strong>traçabilité</strong></span> des choix</li>
<li class="fragment"><span class="blue2"><strong>Qualité</strong></span> du code (structure, documentation)</li>
<li class="fragment">Choix des <span class="blue2"><strong>packages</strong></span> (voir <a href="https://book.utilitr.org/03_Fiches_thematiques/Fiche_comment_choisir_un_package.html">fiche UtilitR</a>)</li>
</ul></li>
</ul>
<div class="fragment">
<div style="font-size: 70%; text-align: justify">
<blockquote>
<p>“Le simple fait qu’un package fasse (ou semble faire) ce que vous voulez n’est pas une raison suffisante de l’utiliser, surtout si votre programme doit rester fonctionnel pendant une longue période. Déterminer si on peut utiliser un package revient à faire un arbitrage entre avantages et inconvénients, et à évaluer le risque d’instabilité d’un package.”</p>
<p><a href="https://book.utilitr.org/03_Fiches_thematiques/Fiche_comment_choisir_un_package.html">UtilitR</a></p>
</blockquote>
</div>
</div>
</section>
<section id="not-just-me-1" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>“Not just me”</h2>
<ul>
<li class="fragment">Organiser le <span class="orange"><strong>travail collaboratif</strong></span>
<ul>
<li class="fragment">S’accorder sur une <span class="blue2"><strong>organisation</strong></span></li>
<li class="fragment">Des outils facilitant via l’<span class="blue2"><strong>écosystème <code>Git</code></strong></span></li>
</ul></li>
<li class="fragment">Traiter le code comme un <span class="orange"><strong>élément méthodologique</strong></span>
<ul>
<li class="fragment"><span class="blue2"><strong>Revue de code</strong></span></li>
</ul></li>
</ul>
<div class="fragment">
<div style="font-size: 70%; text-align: justify">
<blockquote>
<p>“Les développeurs, quel que soit leur rôle, y voient de multiples avantages et un contexte dans lequel ils peuvent se former mutuellement, maintenir l’intégrité des bases de code de leurs équipes et créer, établir et faire évoluer des normes qui garantissent la lisibilité et la cohérence du code.”</p>
<p>Sadowski et al., <em>Modern code review: a case study at google</em> (2018)</p>
</blockquote>
</div>
</div>
</section>
<section id="not-just-me-2" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>“Not just me”</h2>
<ul>
<li class="fragment"><p>Penser à l’expérience des <span class="orange"><strong>utilisateurs finaux</strong></span></p></li>
<li class="fragment"><p>Pour la mise à disposition de données : <a href="https://book.utilitr.org/03_Fiches_thematiques/Fiche_import_fichiers_parquet.html">Parquet</a></p>
<ul>
<li class="fragment"><span class="blue2"><strong>Interopérable</strong></span> et <span class="blue2"><strong>méta-données</strong></span> incluses</li>
<li class="fragment">Performances en <span class="blue2"><strong>stockage</strong></span> et en <span class="blue2"><strong>lecture</strong></span></li>
</ul></li>
<li class="fragment"><p>Pour la documentation / publication : <a href="https://quarto.org/">quarto</a></p>
<ul>
<li class="fragment">Intègre <span class="blue2"><strong>code</strong></span> et <span class="blue2"><strong>texte</strong></span> pour la <span class="blue2"><strong>reproductibilité</strong></span></li>
<li class="fragment">Publication <span class="blue2"><strong>multi-formats</strong></span> (<code>pdf</code>, <code>odt</code>, <code>html</code>)</li>
</ul></li>
<li class="fragment"><p>Exemple “2 en 1” : <a href="https://ssphub.netlify.app/post/parquetrp/">utiliser les données RP en <code>Parquet</code></a></p></li>
</ul>
</section>
<section id="les-trois-commandements-dhadley-2" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Les trois commandements d’Hadley</h2>
<ul>
<li>Le <span class="orange"><strong>code de production</strong></span> a trois caractéristiques
<ul>
<li><span style="color: lightgrey;"><strong>“Not just me”</strong></span></li>
<li><span class="blue2"><strong>“Not just once”</strong></span></li>
<li><span style="color: lightgrey;"><strong>“Not just my computer”</strong></span></li>
</ul></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="img/hadley.jpg" class="quarto-figure quarto-figure-center" height="250"></p>
</figure>
</div>
</section>
<section id="not-just-once" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>“Not just once”</h2>
<ul>
<li class="fragment"><p>Penser son projet en termes de <span class="orange"><strong>reproductibilité</strong></span></p></li>
<li class="fragment"><p>Une tâche de <span class="orange"><strong>production</strong></span></p>
<ul>
<li class="fragment">Est <span class="blue2"><strong>répétée</strong></span> dans le temps</li>
<li class="fragment">Peut <span class="blue2"><strong>changer d’environnement</strong></span> (dev, test, prod…)</li>
</ul></li>
<li class="fragment"><p><span class="orange"><strong>Problème</strong></span> : le monde “autour du code” évolue</p>
<ul>
<li class="fragment"><span class="blue2"><strong>Spécifier</strong></span> et <span class="blue2"><strong>contrôler</strong></span> l’environnement</li>
<li class="fragment"><span class="blue2"><strong>Automatiser</strong></span> ce qui peut l’être</li>
</ul></li>
</ul>
</section>
<section id="not-just-once-1" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>“Not just once”</h2>
<ul>
<li class="fragment">Les <span class="orange"><strong>données</strong></span> changent
<ul>
<li class="fragment"><span class="blue2"><strong>Factoriser</strong></span> le code avec des <span class="blue2"><strong>fonctions</strong></span></li>
<li class="fragment"><span class="blue2"><strong>Modéliser</strong></span> sa chaîne sous forme de <span class="blue2"><strong>DAG</strong></span></li>
</ul></li>
</ul>
<div class="fragment">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="img/dag.png" class="quarto-figure quarto-figure-center" height="250"></p>
</figure>
</div>
<ul>
<li class="fragment">Outil : <a href="https://books.ropensci.org/targets/">{targets}</a></li>
</ul>
</div>
</section>
<section id="not-just-once-2" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>“Not just once”</h2>
<ul>
<li class="fragment"><p>Le <span class="orange"><strong>code</strong></span> / les <span class="orange"><strong>données</strong></span> changent… et <span class="orange"><strong>cassent</strong></span></p></li>
<li class="fragment"><p>Spécifier les <span class="orange"><strong>attendus</strong></span></p>
<ul>
<li class="fragment"><span class="orange"><strong>Tests unitaires</strong></span> : vérifie le bon <span class="blue2"><strong>comportement</strong></span> du code</li>
<li class="fragment"><span class="orange"><strong>Validation de données</strong></span> : vérifie l’<span class="blue2"><strong>intégrité</strong></span> et la <span class="blue2"><strong>qualité</strong></span> des données</li>
</ul></li>
<li class="fragment"><p>Outils : <a href="https://testthat.r-lib.org/">testthat</a> et <a href="https://rstudio.github.io/pointblank/">pointblank</a></p></li>
</ul>
</section>
<section id="not-just-once-3" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>“Not just once”</h2>
<ul>
<li class="fragment"><p>Les <span class="orange"><strong>dépendances</strong></span> changent (fonctionnalités, <em>bugs</em>, failles de sécurité…)</p></li>
<li class="fragment"><p>Arbitrage entre <span class="orange"><strong>évolutivité</strong></span> et <span class="orange"><strong>stabilité</strong></span></p>
<ul>
<li class="fragment">L’<span class="blue2"><strong>évolution des dépendances</strong></span> est inhérente à la <span class="blue2"><strong>maintenance</strong></span> d’une chaîne de production</li>
</ul></li>
<li class="fragment"><p>On limite les risques en <span class="orange"><strong>spécifiant l’environnement</strong></span></p>
<ul>
<li class="fragment"><span class="blue2"><strong>Fixer</strong></span> les versions des packages utilisés : <a href="https://rstudio.github.io/renv/articles/renv.html">renv</a></li>
<li class="fragment"><span class="blue2"><strong>Versionner</strong></span> sa chaîne de production : tags <a href="https://git-scm.com/doc">Git</a></li>
</ul></li>
</ul>
</section>
<section id="not-just-once-4" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>“Not just once”</h2>
<ul>
<li class="fragment">L’<span class="orange"><strong>environnement</strong></span> change (OS, libs système, <code>R</code>…)
<ul>
<li class="fragment">Difficulté principale du <span class="blue2"><strong>passage en production</strong></span></li>
</ul></li>
<li class="fragment">La <span class="orange"><strong>conteneurisation</strong></span> permet de <span class="orange"><strong>fixer l’environnement</strong></span>
<ul>
<li class="fragment">Favorise la <span class="blue2"><strong>portabilité</strong></span></li>
</ul></li>
</ul>
<div class="fragment">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="img/containers-portability.png" class="quarto-figure quarto-figure-center" height="250"></p>
</figure>
</div>
</div>
</section>
<section id="not-just-once-5" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>“Not just once”</h2>
<ul>
<li class="fragment"><p>Concevoir sa chaîne comme un <span class="orange"><strong><em>pipeline</em> de données</strong></span></p>
<ul>
<li class="fragment"><span class="orange"><strong>Reproductibilité</strong></span> : étapes <span class="blue2"><strong>intégrées</strong></span> “de bout en bout”</li>
<li class="fragment"><span class="orange"><strong>Stabilité</strong></span> : contrôle des <span class="blue2"><strong>évolutions</strong></span></li>
<li class="fragment"><span class="orange"><strong>Portabilité</strong></span> : fluidifie le <span class="blue2"><strong>changement d’architecture</strong></span></li>
</ul></li>
<li class="fragment"><p>Avantage supplémentaire : <span class="orange"><strong>automatisation</strong></span></p></li>
<li class="fragment"><p>Outil : <span class="orange"><strong>intégration continue</strong></span> via <code>GitHub</code> / <code>GitLab</code></p>
<ul>
<li class="fragment">Accroît encore les bénéfices d’utiliser <code>Git</code> !</li>
</ul></li>
</ul>
</section>
<section id="les-trois-commandements-dhadley-3" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Les trois commandements d’Hadley</h2>
<ul>
<li>Le <span class="orange"><strong>code de production</strong></span> a trois caractéristiques
<ul>
<li><span style="color: lightgrey;"><strong>“Not just me”</strong></span></li>
<li><span style="color: lightgrey;"><strong>“Not just once”</strong></span></li>
<li><span class="blue2"><strong>“Not just my computer”</strong></span></li>
</ul></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="img/hadley.jpg" class="quarto-figure quarto-figure-center" height="250"></p>
</figure>
</div>
</section>
<section id="not-just-my-computer" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>“Not just my computer”</h2>
<ul>
<li class="fragment">Evolution continue vers des infrastructures de <span class="orange"><strong>self “<em>production-ready</em>”</strong></span></li>
</ul>
<div class="fragment">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="img/evo-infra.png" class="quarto-figure quarto-figure-center" height="400"></p>
</figure>
</div>
</div>
</section>
<section id="not-just-my-computer-1" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>“Not just my computer”</h2>
<ul>
<li class="fragment"><p>OK, mais pourquoi 🤔 ?</p></li>
<li class="fragment"><p>Pourquoi migrer vers des <span class="orange"><strong>infrastructures centralisées</strong></span> ?</p>
<ul>
<li class="fragment"><span class="orange"><strong>Centralisation</strong></span> : permet le <span class="blue2"><strong>passage à l’échelle</strong></span></li>
<li class="fragment"><span class="orange"><strong>Sécurité</strong></span> : évite la <span class="blue2"><strong>dissémination</strong></span> de données</li>
</ul></li>
<li class="fragment"><p>Pourquoi migrer vers des <span class="orange"><strong>infrastructures Kubernetes</strong></span> ?</p>
<ul>
<li class="fragment">Tout ce qu’on pouvait faire avant… <span class="blue2"><strong>en mieux</strong></span></li>
<li class="fragment"><span class="orange"><strong>Nouveaux usages</strong></span> : déploiements (applications, API), calcul distribué, traitements ordonnancés…</li>
<li class="fragment"><span class="orange"><strong>Autonomie</strong></span> (environnement, stockage, etc.)</li>
</ul></li>
</ul>
</section>
<section id="not-just-my-computer-2" class="slide level2" data-auto-animate="true" data-background-image="background.svg" data-background-size="contain">
<h2 data-id="quarto-animate-title">“Not just my computer”</h2>
<p>Un point de départ commun</p>

<img data-src="img/environment_messy.png" class="r-stretch"></section>
<section id="not-just-my-computer-3" class="slide level2" data-auto-animate="true" data-background-image="background.svg" data-background-size="contain">
<h2 data-id="quarto-animate-title">“Not just my computer”</h2>
<p>Un point de départ commun <img data-src="img/environment_messy.png" class="quarto-figure quarto-figure-right" style="width:10.0%"></p>
<p>Une structuration de projet plus viable</p>
<p><img data-src="img/environment_clean.png"></p>
</section>
<section id="not-just-my-computer-4" class="slide level2" data-auto-animate="true" data-background-image="background.svg" data-background-size="contain">
<h2 data-id="quarto-animate-title">“Not just my computer”</h2>
<p>Un point de départ commun <img data-src="img/environment_messy.png" class="quarto-figure quarto-figure-right" style="width:10.0%"></p>
<p>Une structuration de projet plus viable <img data-src="img/environment_clean.png" class="quarto-figure quarto-figure-right" style="width:10.0%"></p>
<p>Facilitée par <span class="orange"><strong>l’éco-système <em>cloud</em></strong></span></p>
<p><img data-src="img/environment_cloud.png"></p>
</section>
<section id="not-just-my-computer-5" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>“Not just my computer”</h2>
<ul>
<li class="fragment"><p>Qu’est-ce qui change 🤔 ?</p></li>
<li class="fragment"><p><span class="orange"><strong>Techniquement</strong></span>, tout… ou presque !</p>
<ul>
<li class="fragment">Du monde <span class="blue2"><strong><em>desktop</em></strong></span> au monde <span class="blue2"><strong><em>server</em></strong></span></li>
<li class="fragment">Du monde <span class="blue2"><strong><em>Windows</em></strong></span> au monde <span class="blue2"><strong><em>Linux</em></strong></span></li>
</ul></li>
<li class="fragment"><p>En pratique, <span class="orange"><strong>Onyxia</strong></span> facilite la <span class="orange"><strong>transition</strong></span></p></li>
</ul>
<div class="fragment">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="img/onyxia-catalog.png" class="quarto-figure quarto-figure-center" height="250"></p>
</figure>
</div>
</div>
</section>
<section id="not-just-my-computer-6" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>“Not just my computer”</h2>
<ul>
<li class="fragment"><p>Qu’est-ce qui change 🤔 ?</p></li>
<li class="fragment"><p><span class="orange"><strong>Monde conteneurisé</strong></span> : les traitements sont <span class="orange"><strong>éphémères</strong></span></p>
<ul>
<li class="fragment">“Coût” de l’<span class="blue2"><strong>autonomie</strong></span> et de la <span class="blue2"><strong>mutualisation</strong></span></li>
<li class="fragment">Mais source de <span class="blue2"><strong>reproductibilité</strong></span> !</li>
</ul></li>
</ul>
<div class="fragment">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="img/environment_clean.png" class="quarto-figure quarto-figure-center" height="300"></p>
</figure>
</div>
</div>
</section>
<section id="not-just-my-computer-7" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>“Not just my computer”</h2>
<ul>
<li class="fragment">Qu’est-ce qui change 🤔 ?
<ul>
<li class="fragment">Evolution du <span class="orange"><strong>mode de stockage de données</strong></span></li>
</ul></li>
<li class="fragment">Infrastructures <span class="orange"><strong>“bureau virtuel”</strong></span> : <span class="blue2"><strong>lecteurs partagés</strong></span>
<ul>
<li class="fragment">Le “bureau virtuel” simule le <span class="blue2"><strong><em>filesystem</em> traditionnel</strong></span></li>
</ul></li>
<li class="fragment">Infrastructures <span class="orange"><strong>cloud</strong></span> : <span class="orange"><strong>stockage objet</strong></span> (<code>S3</code> / <code>MinIO</code>)
<ul>
<li class="fragment">Stockage <span class="blue2"><strong>très peu coûteux</strong></span></li>
<li class="fragment"><span class="orange"><strong>Autonomie</strong></span> : <span class="blue2"><strong><em>bucket</em></strong></span> personnel / de projet</li>
<li class="fragment"><span class="blue2"><strong>Fonctionnement différent</strong></span> des <em>filesystems</em></li>
</ul></li>
</ul>
</section>
<section id="not-just-my-computer-8" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>“Not just my computer”</h2>
<ul>
<li class="fragment"><p>Qu’est-ce qui change 🤔 ?</p></li>
<li class="fragment"><p>Evolution de la <span class="orange"><strong>nature des traitements</strong></span></p>
<ul>
<li class="fragment">Traitements <span class="blue2"><strong>interactifs</strong></span> pour le <span class="blue2"><strong>développement</strong></span></li>
<li class="fragment">Traitements <span class="blue2"><strong>batch</strong></span> pour le <span class="blue2"><strong>déploiement</strong></span></li>
</ul></li>
<li class="fragment"><p>Le <span class="orange"><strong>débogage</strong></span> devient moins immédiat</p>
<ul>
<li class="fragment">Nécessité du <span class="blue2"><strong><em>logging</em></strong></span> : <a href="https://cran.r-project.org/web/packages/logger/vignettes/Intro.html">logger</a></li>
</ul></li>
</ul>
</section>
<section id="dépasser-le-mur-de-la-production" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Dépasser le “mur de la production”</h2>
<ul>
<li class="fragment">Une organisation limitée par l’<span class="orange"><strong>hétérogénéité des environnements</strong></span></li>
</ul>
<div class="fragment">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="img/mur-prod.png" class="quarto-figure quarto-figure-center" height="400"></p>
</figure>
</div>
</div>
</section>
<section id="dépasser-le-mur-de-la-production-1" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Dépasser le “mur de la production”</h2>
<ul>
<li class="fragment">L’opportunité d’organisations <span class="orange"><strong>plus continues</strong></span></li>
</ul>
<div class="fragment">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="img/ideal.png" class="quarto-figure quarto-figure-center" height="450"></p>
</figure>
</div>
</div>
</section>
<section id="application-5-partie-1" class="slide level2 smaller" data-background-image="background.svg" data-background-size="contain">
<h2>Application 5: partie 1</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Partie 1 : transition vers le stockage <code>S3</code></strong></p>
</div>
<div class="callout-content">
<!-------
Tout au long de la formation, on se plaçait déjà dans le paradigme *cloud* dans la mesure où l'on développait dans des **conteneurs** hébergés sur des serveurs distants. Néanmoins, on a traité le stockage de manière "traditionnelle", en important/exportant les fichiers depuis/vers le stockage **local** au conteneur. L'objectif de cet exercice est de transitionner vers un stockage *cloud*, en l'occurence le stockage de type `S3`.
---------->
<ol type="1">
<li>En début de script, créer les chemins où les données pourront être trouvées (voir ci-dessous)</li>
<li>Créer un connecteur <code>Arrow</code> entre votre session <code>R</code> et l’espace de stockage <code>S3</code></li>
</ol>
<div class="sourceCode" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a></a>bucket <span class="ot">&lt;-</span> <span class="fu">s3_bucket</span>(bucket_formation, <span class="at">endpoint_override =</span> <span class="fu">Sys.getenv</span>(<span class="st">"AWS_S3_ENDPOINT"</span>))</span>
<span id="cb9-2"><a></a>bucket_path <span class="ot">&lt;-</span> bucket<span class="sc">$</span><span class="fu">path</span>(<span class="fu">paste0</span>(path_within_bucket, <span class="st">"/RPindividus"</span>))</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="3" type="1">
<li>Dans <code>main.R</code>, modifier les codes utilisant <code>open_dataset</code> pour remplacer les chemins par la variable <code>bucket_path</code>.</li>
</ol>
<div class="sourceCode" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a></a>df <span class="ot">&lt;-</span> <span class="fu">open_dataset</span>(</span>
<span id="cb10-2"><a></a>  bucket_path,</span>
<span id="cb10-3"><a></a>  <span class="at">hive_style =</span> <span class="cn">TRUE</span></span>
<span id="cb10-4"><a></a>) <span class="sc">%&gt;%</span></span>
<span id="cb10-5"><a></a>  <span class="fu">filter</span>(REGION <span class="sc">==</span> <span class="dv">24</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-6"><a></a>  <span class="fu">select</span>(<span class="fu">any_of</span>(columns_subset)) <span class="sc">%&gt;%</span></span>
<span id="cb10-7"><a></a>  <span class="fu">collect</span>()</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="4" type="1">
<li>Si nécessaire, remplacer l’import du geojson</li>
</ol>
<div class="sourceCode" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a></a>departements <span class="ot">&lt;-</span> aws.s3<span class="sc">::</span><span class="fu">s3read_using</span>(</span>
<span id="cb11-2"><a></a>  <span class="at">FUN =</span> sf<span class="sc">::</span>st_read, </span>
<span id="cb11-3"><a></a>  <span class="at">object =</span> <span class="st">"france.geojson"</span>, </span>
<span id="cb11-4"><a></a>  <span class="at">bucket =</span> <span class="fu">paste0</span>(bucket_formation, <span class="st">"/"</span>, path_within_bucket),</span>
<span id="cb11-5"><a></a>  <span class="at">opts =</span> <span class="fu">list</span>(<span class="st">"region"</span> <span class="ot">=</span> <span class="st">""</span>)</span>
<span id="cb11-6"><a></a>  )</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><br></p>
<details>
<summary>
Connecteur pour la question 1
</summary>
<div class="panel-tabset">
<ul id="tabset-6" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-6-1"><i class="fa-brands fa-github" aria-label="github"></i></a></li><li><a href="#tabset-6-2"><i class="fa-brands fa-gitlab" aria-label="gitlab"></i> insee</a></li></ul>
<div class="tab-content">
<div id="tabset-6-1">
<div class="sourceCode" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a></a>bucket_formation <span class="ot">&lt;-</span> <span class="st">"projet-formation"</span></span>
<span id="cb12-2"><a></a>path_within_bucket <span class="ot">&lt;-</span> <span class="st">"/bonnes-pratiques/data"</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-6-2">
<div class="sourceCode" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a></a>bucket_formation <span class="ot">&lt;-</span> <span class="st">"public"</span></span>
<span id="cb13-2"><a></a>path_within_bucket <span class="ot">&lt;-</span> <span class="st">"/ssplab-formation"</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</details>
</div>
</div>
</div>
</section>
<section id="application-5-partie-2" class="slide level2 smaller" data-background-image="background.svg" data-background-size="contain">
<h2>Application 5: partie 2</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Partie 2 : orchestrer sa chaîne de production</strong></p>
</div>
<div class="callout-content">
<p>Au fil des chapitres précédents, nous avons appliqué un ensemble de bonnes pratiques à notre chaîne de production pour accroître sa qualité et sa maintenabilité. Néanmoins, celle-ci est encore sous la forme d’un unique <em>script</em>.</p>
<p>De manière générale, on a plutôt envie de modéliser les étapes d’une chaîne comme une série de fonctions, avec une fonction “cheffe d’orchestre” qui appelle les autres dans le bon ordre.</p>
<ol type="1">
<li>Créer les scripts suivants:</li>
</ol>
<ul>
<li><code>R/functions_import.R</code> (<a href="https://raw.githubusercontent.com/InseeFrLab/formation-bonnes-pratiques-git-R/refs/heads/main/R/checkpoints/application5_part2/R/functions_import.R">contenu</a>)</li>
<li><code>R/functions_stats_desc.R</code> (<a href="https://raw.githubusercontent.com/InseeFrLab/formation-bonnes-pratiques-git-R/refs/heads/main/R/checkpoints/application5_part2/R/functions_stats_desc.R">contenu</a>)</li>
<li><code>R/functions_models.R</code> (<a href="https://raw.githubusercontent.com/InseeFrLab/formation-bonnes-pratiques-git-R/refs/heads/main/R/checkpoints/application5_part2/R/functions_models.R">contenu</a>)</li>
</ul>
<ol start="2" type="1">
<li><p>Modifier <code>main.R</code> pour tenir compte de la modularisation (<a href="https://raw.githubusercontent.com/InseeFrLab/formation-bonnes-pratiques-git-R/refs/heads/main/R/checkpoints/application5_part2/main_sspcloud.R">version <i class="fa-brands fa-github" aria-label="github"></i> + sspcloud</a> ou <a href="https://raw.githubusercontent.com/InseeFrLab/formation-bonnes-pratiques-git-R/refs/heads/main/R/checkpoints/application5_part2/main_sspcloud_ls3.R">version <i class="fa-brands fa-gitlab" aria-label="gitlab"></i> + LS3</a>)</p></li>
<li><p>Passer la souris sur une des nouvelles fonctions et faire <kbd>F1</kbd></p></li>
</ol>
</div>
</div>
</div>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong><code>targets</code>: un orchestrateur formel</strong></p>
</div>
<div class="callout-content">
<p>On aurait pu également utiliser un <strong>orchestrateur</strong> dédié pour effectuer cette tâche, comme le package <a href="https://books.ropensci.org/targets/">targets</a>. Les plus curieux d’entre vous pourront aller voir <a href="https://github.com/InseeFrLab/formation-bonnes-pratiques-git-R/blob/main/slides/legacy/data_pipelines.qmd">le chapitre et les exercices</a> qui lui étaient auparavant dédiés dans cette formation.</p>
</div>
</div>
</div>
</section>
<section id="application-5-partie-3" class="slide level2 smaller" data-background-image="background.svg" data-background-size="contain">
<h2>Application 5: partie 3</h2>
<div class="noincremental">
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Partie 3 : ajout de contrôles de qualité des données</strong></p>
</div>
<div class="callout-content">
<p>Un critère de qualité majeur d’une chaîne de production est sa robustesse. Naturellement, les données en entrée de la chaîne peuvent évoluer dans le temps. Afin de gérer au mieux les risques posés par de telles évolutions, on va ajouter des contrôles sur la qualité des données, en entrée et en sortie de la chaîne.</p>
</div>
</div>
</div>
</div>
<div class="noincremental">
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Partie 4 : tests unitaires et versionnage de la chaîne</strong></p>
</div>
<div class="callout-content">
<p>Notre chaîne tourne à présent de manière robuste. Pour autant, ce n’est pas un objet fixe : on peut vouloir lui apporter des corrections ou des améliorations fonctionnelles. Et ces modifications peuvent, à leur tour, provoquer des nouvelles erreurs. Pour gérer ces risques, on va : - versionner la chaîne, afin de certifier le code qui la fait tourner sans erreur à un moment T - implémenter des tests unitaires, qui permettent de continuer à modifier la chaîne sans risquer de <strong>régressions</strong></p>
</div>
</div>
</div>
</div>
<div class="noincremental">
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Partie 5 : un rapport reproductible pour documenter sa chaîne de production</strong></p>
</div>
<div class="callout-content">
<p>Une bonne manière de favoriser à la fois la maintenabilité de sa chaîne et la réutilisationde ses produits est de documenter son fonctionnement. Le format <a href="https://quarto.org">quarto</a> — successeur de <code>R Markdown</code> — permet de reproduire facilement des <strong>rapports reproductibles, qui intègrent code et texte</strong>. En plus, ces rapports peuvent être facilement publiés en différents formats, du plus <strong>interactif</strong> (<code>html</code>) aux plus classiques (<code>pdf</code>, <code>odt</code>, etc.).</p>
</div>
</div>
</div>
</div>
<div class="noincremental">
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Partie 6 : automatiser la mise à disposition</strong></p>
</div>
<div class="callout-content">
<p>On dispose finalement d’une chaîne <strong>orchestrée, robuste et bien documentée</strong>. Afin d’en faire une chaîne vraiment intégrée de bout en bout, on va <strong>automatiser</strong> les étapes, de sorte à ce que les modifications apportées au projet se répércutent sur ses sorties. Pour cela, on va utiliser les outils de l’<strong>intégration continue</strong> proposés par <code>GitHub</code> / <code>GitLab</code>.</p>
</div>
</div>
</div>
</div>
</section>
<section id="ressources-supplémentaires-4" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Ressources supplémentaires</h2>
<ul>
<li class="fragment"><p>La <a href="https://book.utilitr.org/">documentation <code>utilitR</code></a></p></li>
<li class="fragment"><p>Cours <a href="https://ensae-reproductibilite.github.io/website/">Reproductibilité et bonnes pratiques pour les projets de data science</a> de l’<code>ENSAE</code></p></li>
<li class="fragment"><p><a href="https://eliocamp.github.io/reproducibility-with-r/">Un cours complet</a> (en anglais) sur la reproductibilité avec <code>R</code></p></li>
<li class="fragment"><p>Conférence <a href="https://www.youtube.com/watch?v=BQk2-3inViM">“R in production”</a> d’Hadley Wickham (en anglais)</p></li>
<li class="fragment"><p>Le cours (en construction) <a href="https://r-in-production.org/">“R in production”</a> d’Hadley Wickham (en anglais)</p></li>
</ul>
</section></section>
<section>
<section id="conclusion" class="title-slide slide level1 center" data-background-image="background.svg" data-background-size="contain">
<h1>Conclusion</h1>

</section>
<section id="conclusion-1" class="slide level2" data-background-image="background.svg" data-background-size="contain">
<h2>Conclusion</h2>
<ul>
<li class="fragment"><p>Des <span class="orange"><strong>standards communautaires</strong></span> qui favorisent la <span class="blue2"><strong>reproductibilité</strong></span> et la <span class="blue2"><strong>maintenabilité</strong></span></p></li>
<li class="fragment"><p>De multiples <span class="orange"><strong>outils</strong></span> pour simplifier leur mise en oeuvre</p></li>
<li class="fragment"><p>Un <span class="orange"><strong>coût</strong></span> d’autant plus faible que l’on se place <span class="orange"><strong>en amont</strong></span></p></li>
<li class="fragment"><p>Le mouvement de <span class="orange"><strong>modernisation du self</strong></span> est l’occasion d’une <span class="blue2"><strong>montée en compétence collective</strong></span></p></li>
</ul>
</section>
<section id="ressources-communautaires" class="slide level2 smaller" data-background-image="background.svg" data-background-size="contain">
<h2>Ressources communautaires</h2>
<ul>
<li class="fragment"><span class="orange"><strong>Canaux de discussion</strong></span>
<ul>
<li class="fragment">A l’Insee
<ul>
<li class="fragment">Pour toute question sur <span class="blue2"><strong>Git</strong></span> : <a href="https://tchap.gouv.fr/#/room/#InseeGitGitlablPtu8f1Frns:agent.finances.tchap.gouv.fr">Insee-Git-Gitlab</a></li>
<li class="fragment">Pour toute question <span class="blue2"><strong>stat/self</strong></span> : <a href="https://tchap.gouv.fr/#/room/#InseeOutilsStatsv2wtxSdth:agent.finances.tchap.gouv.fr">Insee - Outils Stats v2</a></li>
<li class="fragment">Pour toute question spécifique à <span class="blue2"><strong>AUS/LS3</strong></span> : <a href="https://matrix.to/#/!bxlTbQgAEcLkRjoNPi:agent.finances.tchap.gouv.fr?via=agent.finances.tchap.gouv.fr&amp;via=agent.agriculture.tchap.gouv.fr&amp;via=agent.interieur.tchap.gouv.fr">Insee-DSI-Plateformes-Internes-Datascience</a></li>
</ul></li>
<li class="fragment">Plus largement sur <span class="blue2"><strong>R</strong></span>
<ul>
<li class="fragment">Sur <code>Tchap</code> : <a href="https://tchap.gouv.fr/#/room/#RdIezwNF:agent.finances.tchap.gouv.fr">Langage R (Tchap)</a></li>
<li class="fragment">Sur <code>Slack</code> : <a href="https://r-grrr.slack.com">r-grrr</a></li>
</ul></li>
</ul></li>
<li class="fragment"><span class="orange"><strong>Documentation</strong></span>
<ul>
<li class="fragment"><a href="https://datascience.gitlab-pages.insee.fr/site-documentaire/accueil/">Service datascience Insee</a></li>
<li class="fragment"><a href="https://book.utilitr.org/">UtilitR</a></li>
</ul></li>
<li class="fragment"><span class="orange"><strong>Formation</strong></span>
<ul>
<li class="fragment"><a href="https://www.sspcloud.fr/formation">Espace formation du SSP Cloud</a></li>
</ul></li>
</ul>


</section></section>

    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">
<p>Bonnes pratiques pour les projets statistiques (<a href="https://inseefrlab.github.io/formation-bonnes-pratiques-git-R/">retour au site principal</a> ; <a href="https://github.com/InseeFrLab/formation-bonnes-pratiques-git-R"><i class="fa-brands fa-github"></i></a>)</p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': false,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"8\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'chalkboard': {"buttons":true,"theme":"whiteboard"},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: true,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
      window.document.addEventListener("DOMContentLoaded", function (event) {
        const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
        tabsets.forEach(function(tabset) {
          const tabby = new Tabby('#' + tabset.id);
        });
        const isCodeAnnotation = (el) => {
          for (const clz of el.classList) {
            if (clz.startsWith('code-annotation-')) {                     
              return true;
            }
          }
          return false;
        }
        const onCopySuccess = function(e) {
          // button target
          const button = e.trigger;
          // don't keep focus
          button.blur();
          // flash "checked"
          button.classList.add('code-copy-button-checked');
          var currentTitle = button.getAttribute("title");
          button.setAttribute("title", "Copié");
          let tooltip;
          if (window.bootstrap) {
            button.setAttribute("data-bs-toggle", "tooltip");
            button.setAttribute("data-bs-placement", "left");
            button.setAttribute("data-bs-title", "Copié");
            tooltip = new bootstrap.Tooltip(button, 
              { trigger: "manual", 
                customClass: "code-copy-button-tooltip",
                offset: [0, -8]});
            tooltip.show();    
          }
          setTimeout(function() {
            if (tooltip) {
              tooltip.hide();
              button.removeAttribute("data-bs-title");
              button.removeAttribute("data-bs-toggle");
              button.removeAttribute("data-bs-placement");
            }
            button.setAttribute("title", currentTitle);
            button.classList.remove('code-copy-button-checked');
          }, 1000);
          // clear code selection
          e.clearSelection();
        }
        const getTextToCopy = function(trigger) {
            const codeEl = trigger.previousElementSibling.cloneNode(true);
            for (const childEl of codeEl.children) {
              if (isCodeAnnotation(childEl)) {
                childEl.remove();
              }
            }
            return codeEl.innerText;
        }
        const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
          text: getTextToCopy
        });
        clipboard.on('success', onCopySuccess);
        if (window.document.getElementById('quarto-embedded-source-code-modal')) {
          const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
            text: getTextToCopy,
            container: window.document.getElementById('quarto-embedded-source-code-modal')
          });
          clipboardModal.on('success', onCopySuccess);
        }
          var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
          var mailtoRegex = new RegExp(/^mailto:/);
            var filterRegex = new RegExp("https:\/\/InseeFrLab\.github\.io\/formation-bonnes-pratiques-git-R\/");
          var isInternal = (href) => {
              return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
          }
          // Inspect non-navigation links and adorn them if external
         var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
          for (var i=0; i<links.length; i++) {
            const link = links[i];
            if (!isInternal(link.href)) {
              // undo the damage that might have been done by quarto-nav.js in the case of
              // links that we want to consider external
              if (link.dataset.originalHref !== undefined) {
                link.href = link.dataset.originalHref;
              }
            }
          }
        function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
          const config = {
            allowHTML: true,
            maxWidth: 500,
            delay: 100,
            arrow: false,
            appendTo: function(el) {
                return el.closest('section.slide') || el.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'light-border',
            placement: 'bottom-start',
          };
          if (contentFn) {
            config.content = contentFn;
          }
          if (onTriggerFn) {
            config.onTrigger = onTriggerFn;
          }
          if (onUntriggerFn) {
            config.onUntrigger = onUntriggerFn;
          }
            config['offset'] = [0,0];
            config['maxWidth'] = 700;
          window.tippy(el, config); 
        }
        const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
        for (var i=0; i<noterefs.length; i++) {
          const ref = noterefs[i];
          tippyHover(ref, function() {
            // use id or data attribute instead here
            let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
            try { href = new URL(href).hash; } catch {}
            const id = href.replace(/^#\/?/, "");
            const note = window.document.getElementById(id);
            if (note) {
              return note.innerHTML;
            } else {
              return "";
            }
          });
        }
        const findCites = (el) => {
          const parentEl = el.parentElement;
          if (parentEl) {
            const cites = parentEl.dataset.cites;
            if (cites) {
              return {
                el,
                cites: cites.split(' ')
              };
            } else {
              return findCites(el.parentElement)
            }
          } else {
            return undefined;
          }
        };
        var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
        for (var i=0; i<bibliorefs.length; i++) {
          const ref = bibliorefs[i];
          const citeInfo = findCites(ref);
          if (citeInfo) {
            tippyHover(citeInfo.el, function() {
              var popup = window.document.createElement('div');
              citeInfo.cites.forEach(function(cite) {
                var citeDiv = window.document.createElement('div');
                citeDiv.classList.add('hanging-indent');
                citeDiv.classList.add('csl-entry');
                var biblioDiv = window.document.getElementById('ref-' + cite);
                if (biblioDiv) {
                  citeDiv.innerHTML = biblioDiv.innerHTML;
                }
                popup.appendChild(citeDiv);
              });
              return popup.innerHTML;
            });
          }
        }
      });
      </script>
    

</body></html>